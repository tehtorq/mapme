import{f as z,a as A,c as Ze}from"../chunks/C7mDw3il.js";import"../chunks/B0R5ntbu.js";import{m as Y,n as dt,X as ut,g as h,ab as be,Z as vt,_ as ft,$ as Pe,G as Ne,F as Te,I as ue,J as pt,a0 as We,Q as qe,a1 as gt,N as Ge,y as mt,a6 as N,ao as Oe,ap as Le,w as je,aq as ht,ar as bt,as as xt,M as _t,at as yt,au as wt,av as kt,aw as St,D as Tt,ax as Lt,ay as Et,az as Dt,aA as Mt,a8 as Rt,z as It,p as te,k as p,s as T,l as g,t as ve,j as ae,i as xe,a7 as M,aB as se,aC as Ye,aD as Je}from"../chunks/D_9gYwmd.js";import{p as C,i as F,_ as Me,s as ge,b as fe,a as Q,c as he}from"../chunks/oce6cgei.js";import{i as oe}from"../chunks/B-Ci0uq9.js";import{w as Ke,c as At,o as pe,a as Ct}from"../chunks/SChdK5eF.js";import{s as O,e as B}from"../chunks/C0-CMGp8.js";function $t(t,e,a,c){for(var s=[],r=e.length,o=0;o<r;o++)xt(e[o].e,s,!0);var u=r>0&&s.length===0&&a!==null;if(u){var x=a.parentNode;_t(x),x.append(a),c.clear(),X(t,e[0].prev,e[r-1].next)}yt(s,()=>{for(var b=0;b<r;b++){var n=e[b];u||(c.delete(n.k),X(t,n.prev,n.next)),wt(n.e,!u)}})}function zt(t,e,a,c,s,r=null){var o=t,u={flags:e,items:new Map,first:null};Y&&dt();var x=null,b=!1,n=be(()=>{var v=a();return mt(v)?v:v==null?[]:Ge(v)});ut(()=>{var v=h(n),l=v.length;if(b&&l===0)return;b=l===0;let m=!1;if(Y){var f=vt(o)===ft;f!==(l===0)&&(o=Pe(),Ne(o),Te(!1),m=!0)}if(Y){for(var w=null,_,d=0;d<l;d++){if(ue.nodeType===8&&ue.data===pt){o=ue,m=!0,Te(!1);break}var i=v[d],k=c(i,d);_=Xe(ue,u,w,null,i,k,d,s,e,a),u.items.set(k,_),w=_}l>0&&Ne(Pe())}Y||Pt(v,u,o,s,e,c,a),r!==null&&(l===0?x?We(x):x=qe(()=>r(o)):x!==null&&gt(x,()=>{x=null})),m&&Te(!0),h(n)}),Y&&(o=ue)}function Pt(t,e,a,c,s,r,o){var u=t.length,x=e.items,b=e.first,n=b,v,l=null,m=[],f=[],w,_,d,i;for(i=0;i<u;i+=1){if(w=t[i],_=r(w,i),d=x.get(_),d===void 0){var k=n?n.e.nodes_start:a;l=Xe(k,e,l,l===null?e.first:l.next,w,_,i,c,s,o),x.set(_,l),m=[],f=[],n=l.next;continue}if(Nt(d,w,i),(d.e.f&Le)!==0&&We(d.e),d!==n){if(v!==void 0&&v.has(d)){if(m.length<f.length){var y=f[0],L;l=y.prev;var E=m[0],R=m[m.length-1];for(L=0;L<m.length;L+=1)Be(m[L],y,a);for(L=0;L<f.length;L+=1)v.delete(f[L]);X(e,E.prev,R.next),X(e,l,E),X(e,R,y),n=y,l=R,i-=1,m=[],f=[]}else v.delete(d),Be(d,n,a),X(e,d.prev,d.next),X(e,d,l===null?e.first:l.next),X(e,l,d),l=d;continue}for(m=[],f=[];n!==null&&n.k!==_;)(n.e.f&Le)===0&&(v??(v=new Set)).add(n),f.push(n),n=n.next;if(n===null)continue;d=n}m.push(d),l=d,n=d.next}if(n!==null||v!==void 0){for(var j=v===void 0?[]:Ge(v);n!==null;)(n.e.f&Le)===0&&j.push(n),n=n.next;var P=j.length;if(P>0){var $=null;$t(e,j,$,x)}}je.first=e.first&&e.first.e,je.last=l&&l.e}function Nt(t,e,a,c){bt(t.v,e),t.i=a}function Xe(t,e,a,c,s,r,o,u,x,b){var n=(x&kt)!==0,v=(x&St)===0,l=n?v?N(s):Oe(s):s,m=(x&ht)===0?o:Oe(o),f={i:m,v:l,k:r,a:null,e:null,prev:a,next:c};try{return f.e=qe(()=>u(t,l,m,b),Y),f.e.prev=a&&a.e,f.e.next=c&&c.e,a===null?e.first=f:(a.next=f,a.e.next=f.e),c!==null&&(c.prev=f,c.e.prev=f.e),f}finally{}}function Be(t,e,a){for(var c=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,r=t.e.nodes_start;r!==c;){var o=Tt(r);s.before(r),r=o}}function X(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ot(t,e,a){var c=t==null?"":""+t;return c===""?null:c}function Ee(t,e,a,c,s,r){var o=t.__className;if(Y||o!==a||o===void 0){var u=Ot(a);(!Y||u!==t.getAttribute("class"))&&(u==null?t.removeAttribute("class"):t.className=u),t.__className=a}return r}const jt=Symbol("is custom element"),Bt=Symbol("is html");function Ve(t,e,a,c){var s=Vt(t);Y&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=a)&&(e==="loading"&&(t[Lt]=a),a==null?t.removeAttribute(e):typeof a!="string"&&Ut(t).includes(e)?t[e]=a:t.setAttribute(e,a))}function Vt(t){return t.__attributes??(t.__attributes={[jt]:t.nodeName.includes("-"),[Bt]:t.namespaceURI===Et})}var Ue=new Map;function Ut(t){var e=Ue.get(t.nodeName);if(e)return e;Ue.set(t.nodeName,e=[]);for(var a,c=t,s=Element.prototype;s!==c;){a=Mt(c);for(var r in a)a[r].set&&e.push(r);c=Dt(c)}return e}function De(t,e,a){var c=Rt(t,e);c&&c.set&&(t[e]=a,It(()=>{t[e]=null}))}function Fe(t){return function(...e){var a=e[0];return a.stopPropagation(),t==null?void 0:t.apply(this,e)}}function Ft(t){let e=0;for(let a=1;a<t.length;a++){const[c,s]=t[a-1],[r,o]=t[a],u=6371,x=(r-c)*Math.PI/180,b=(o-s)*Math.PI/180,n=Math.sin(x/2)*Math.sin(x/2)+Math.cos(c*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(b/2)*Math.sin(b/2),v=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),l=u*v;e+=l}return e}function Ht(t,e){return e===0?0:t/e*3600}function Re(t){const e=Math.floor(t/3600),a=Math.floor(t%3600/60),c=Math.floor(t%60);return e>0?`${e}h ${a}m ${c}s`:a>0?`${a}m ${c}s`:`${c}s`}function Ie(t){return t<1?`${Math.round(t*1e3)}m`:`${t.toFixed(2)}km`}function Zt(){return new Date().toISOString()}function Wt(){return`route_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}var qt=z('<div class="absolute top-2.5 left-2.5 bg-white/95 p-4 rounded-xl shadow-md z-[400] min-w-[200px] sm:top-[60px] sm:left-2.5 sm:right-2.5 sm:min-w-0"><div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Time:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Distance:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Current Speed:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Avg Speed:</span> <span class="font-bold text-gray-800"> </span></div></div>');function Gt(t,e){te(e,!1);let a=C(e,"elapsedTime",8,0),c=C(e,"distance",8,0),s=C(e,"currentSpeed",8,0),r=C(e,"avgSpeed",8,0);oe();var o=qt(),u=p(o),x=T(p(u),2),b=p(x,!0);g(x),g(u);var n=T(u,2),v=T(p(n),2),l=p(v,!0);g(v),g(n);var m=T(n,2),f=T(p(m),2),w=p(f);g(f),g(m);var _=T(m,2),d=T(p(_),2),i=p(d);g(d),g(_),g(o),ve((k,y,L,E)=>{O(b,k),O(l,y),O(w,`${L??""} km/h`),O(i,`${E??""} km/h`)},[()=>Re(a()),()=>Ie(c()),()=>s().toFixed(1),()=>r().toFixed(1)],be),A(t,o),ae()}var Yt=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-green-500 hover:bg-green-600">Start Tracking</button>'),Jt=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-amber-500 hover:bg-amber-600">Pause</button>'),Kt=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-blue-500 hover:bg-blue-600">Resume</button>'),Xt=z('<!> <button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-red-500 hover:bg-red-600">Stop</button>',1),Qt=z('<div class="fixed bottom-0 left-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><!></div>');function ea(t,e){let a=C(e,"tracking",8,!1),c=C(e,"paused",8,!1),s=C(e,"onStart",8,()=>{}),r=C(e,"onPause",8,()=>{}),o=C(e,"onStop",8,()=>{});var u=Qt(),x=p(u);{var b=v=>{var l=Yt();B("click",l,function(...m){var f;(f=s())==null||f.apply(this,m)}),A(v,l)},n=v=>{var l=Xt(),m=xe(l);{var f=d=>{var i=Jt();B("click",i,function(...k){var y;(y=r())==null||y.apply(this,k)}),A(d,i)},w=d=>{var i=Kt();B("click",i,function(...k){var y;(y=r())==null||y.apply(this,k)}),A(d,i)};F(m,d=>{c()?d(w,!1):d(f)})}var _=T(m,2);B("click",_,function(...d){var i;(i=o())==null||i.apply(this,d)}),A(v,l)};F(x,v=>{a()?v(n,!1):v(b)})}g(u),A(t,u)}const Z=Ke("idle"),He=Ke(null);var ta=z('<div class="w-full h-full flex items-center justify-center bg-gray-50"><div class="text-center p-8"><svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <h2 class="text-xl font-semibold text-gray-700 mb-2">Location Access Required</h2> <p class="text-gray-500 mb-4">Please enable location services to use MapMe</p> <button class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">Retry</button></div></div>'),aa=z('<div class="w-full h-full flex items-center justify-center bg-gray-50"><div class="text-center"><div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div> <p class="mt-4 text-gray-600">Finding your location...</p></div></div>'),oa=z('<div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded-lg shadow-lg z-[500] animate-fadeIn"> </div>'),ra=z('<div id="map" class="w-full h-full"></div> <!> <!> <div class="absolute top-2.5 right-[60px] flex flex-col gap-2.5 z-[400]"><button><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></svg></button></div> <div class="absolute top-2.5 left-2.5 flex gap-1.5 z-[400] bg-white/90 p-1.5 rounded-lg"><button>Street</button> <button>Satellite</button></div> <!>',1),na=z('<div class="w-full h-full relative"><!></div>');function ia(t,e){te(e,!1);const[a,c]=ge(),s=At();let r,o,u,x=N(),b=N("street"),n=N(!0),v=N(!1),l=N(!1),m=C(e,"tracking",12,!1),f=C(e,"paused",12,!1),w=[],_=[],d=null,i=null,k=null,y=null,L=N(0),E=N(0),R=N(0),j=N(0),P=null,$=null,W=N(null),q=null;const H={street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"}};pe(async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async S=>{const{latitude:V,longitude:U}=S.coords;M(v,!0),o=await Me(()=>import("../chunks/r9KgTLRM.js").then(J=>J.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(h(x),{zoomControl:!1}).setView([V,U],16),o.control.zoom({position:"topright"}).addTo(r),u=o.tileLayer(H[h(b)].url,{attribution:H[h(b)].attribution,maxZoom:19}).addTo(r),k=o.marker([V,U]).addTo(r).bindPopup("Current location")},S=>{console.error("Error getting location:",S),M(l,!0)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):M(l,!0)});function re(){!document.hidden&&m()&&!$&&"wakeLock"in navigator&&navigator.wakeLock.request("screen").then(S=>{$=S,$.addEventListener("release",()=>{console.log("Wake Lock was released")}),console.log("Wake Lock re-acquired")}).catch(S=>{console.error("Failed to re-acquire wake lock:",S)})}pe(()=>{document.addEventListener("visibilitychange",re)}),Ct(()=>{document.removeEventListener("visibilitychange",re),$!==null&&$.release().catch(()=>{}),d!==null&&navigator.geolocation.clearWatch(d),P!==null&&clearInterval(P),r&&r.remove()});function D(){r&&setTimeout(()=>{r.invalidateSize()},100)}function I(S){!r||!o||(i&&r.removeLayer(i),i=o.polyline(S.positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r),o.marker(S.positions[0]).addTo(r).bindPopup("Start").openPopup(),o.marker(S.positions[S.positions.length-1]).addTo(r).bindPopup("End"),r.fitBounds(i.getBounds(),{padding:[50,50]}))}function ne(S){!o||!r||(M(b,S),u&&(r.removeLayer(u),u=o.tileLayer(H[h(b)].url,{attribution:H[h(b)].attribution,maxZoom:19}).addTo(r)))}async function le(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}if("wakeLock"in navigator)try{$=await navigator.wakeLock.request("screen"),$.addEventListener("release",()=>{console.log("Wake Lock was released")}),console.log("Wake Lock is active"),at("Screen will stay on during tracking")}catch(S){console.error(`${S.name}, ${S.message}`)}Q(Z,"tracking"),m(!0),f(!1),w=[],_=[],y=Date.now(),P=setInterval(()=>{f()||M(L,Math.floor((Date.now()-y)/1e3))},1e3),d=navigator.geolocation.watchPosition(S=>{if(f())return;const{latitude:V,longitude:U,speed:J,accuracy:K}=S.coords;if(K>50)return;const ie=5;let ce=!0;if(w.length>0){const de=w[w.length-1];ce=o.latLng(de[0],de[1]).distanceTo(o.latLng(V,U))>=ie}k&&k.setLatLng([V,U]),ce&&(w=[...w,[V,U]],_=[..._,Date.now()],w.length>1&&(M(E,Ft(w)),M(j,Ht(h(E),h(L))),M(R,J?J*3.6:0)),w.length>1&&(i?i.setLatLngs(w):i=o.polyline(w,{color:"#3B82F6",weight:5,opacity:.8,smoothFactor:1}).addTo(r))),h(n)&&r.setView([V,U],r.getZoom(),{animate:!0,duration:.5})},S=>{console.error("Error tracking position:",S)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})}function Qe(){f(!f()),f()&&(y+=Date.now()-(y+h(L)*1e3))}async function et(){if(Q(Z,"idle"),m(!1),f(!1),$!==null)try{await $.release(),$=null,console.log("Wake Lock released")}catch(S){console.error("Error releasing wake lock:",S)}if(d!==null&&(navigator.geolocation.clearWatch(d),d=null),P!==null&&(clearInterval(P),P=null),w.length>1){const S={positions:w,timestamps:_,distance:h(E),duration:h(L),avgSpeed:h(j),startTime:new Date(_[0]).toLocaleTimeString(),endTime:new Date(_[_.length-1]).toLocaleTimeString()};console.log("Dispatching route complete event:",S),s("routeComplete",S),i&&(r.removeLayer(i),i=null),w=[],_=[],M(E,0),M(L,0),M(R,0),M(j,0)}}function tt(){M(n,!h(n))}function at(S){M(W,S),q&&clearTimeout(q),q=setTimeout(()=>{M(W,null),q=null},3e3)}oe();var _e=na(),ot=p(_e);{var rt=S=>{var V=ta(),U=p(V),J=T(p(U),6);g(U),g(V),B("click",J,()=>window.location.reload()),A(S,V)},nt=(S,V)=>{{var U=K=>{var ie=aa();A(K,ie)},J=K=>{var ie=ra(),ce=xe(ie);fe(ce,G=>M(x,G),()=>h(x));var de=T(ce,2);{var Ce=G=>{Gt(G,{get elapsedTime(){return h(L)},get distance(){return h(E)},get currentSpeed(){return h(R)},get avgSpeed(){return h(j)}})};F(de,G=>{m()&&G(Ce)})}var $e=T(de,2);{var st=G=>{var Se=oa(),ct=p(Se,!0);g(Se),ve(()=>O(ct,h(W))),A(G,Se)};F($e,G=>{h(W)&&G(st)})}var ye=T($e,2),me=p(ye);g(ye);var we=T(ye,2),ke=p(we),ze=T(ke,2);g(we);var lt=T(we,2);ea(lt,{get tracking(){return m()},get paused(){return f()},onStart:le,onPause:Qe,onStop:et}),ve(()=>{Ee(me,1,`border-none w-10 h-10 rounded-lg cursor-pointer shadow-md flex items-center justify-center transition-all duration-200 hover:scale-105 ${h(n)?"bg-blue-500 text-white hover:bg-blue-600":"bg-white text-gray-700 hover:bg-gray-100"}`),Ve(me,"title",`${h(n)?"Disable":"Enable"} location following`),Ve(me,"aria-label",`${h(n)?"Disable":"Enable"} location following`),Ee(ke,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${h(b)==="street"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`),Ee(ze,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${h(b)==="satellite"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`)}),B("click",me,tt),B("click",ke,()=>ne("street")),B("click",ze,()=>ne("satellite")),A(K,ie)};F(S,K=>{h(v)?K(J,!1):K(U)},V)}};F(ot,S=>{h(l)?S(rt):S(nt,!1)})}g(_e),A(t,_e),De(e,"invalidateSize",D),De(e,"showRoute",I);var it=ae({invalidateSize:D,showRoute:I});return c(),it}var sa=z('<div class="bg-white rounded-2xl overflow-hidden shadow-md cursor-pointer transition-all duration-200 outline-none hover:-translate-y-0.5 hover:shadow-lg focus:outline-2 focus:outline-offset-2 focus:outline-blue-500" role="button" tabindex="0" aria-label="View route details"><div class="w-full h-[150px] bg-gray-200"></div> <div class="p-4"><div class="flex justify-between items-start mb-2.5"><div><div class="text-base font-semibold text-gray-800"> </div> <div class="text-sm text-gray-500"> </div></div></div> <div class="grid grid-cols-3 gap-2.5 mb-2.5"><div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Distance</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Duration</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Avg Speed</div></div></div> <div class="flex gap-2.5 mt-2.5"><button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-blue-100 text-blue-700 hover:bg-blue-200">Export</button> <button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-red-100 text-red-700 hover:bg-red-200">Delete</button></div></div></div>');function la(t,e){te(e,!1);let a=C(e,"route",8),c=C(e,"onView",8,()=>{}),s=C(e,"onExport",8,()=>{}),r=C(e,"onDelete",8,()=>{}),o,u=N();pe(async()=>{const D=await Me(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url);if(h(u)){o=D.map(h(u),{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1}),D.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(o);const I=D.polyline(a().positions,{color:"#3B82F6",weight:3,opacity:.8}).addTo(o);o.fitBounds(I.getBounds(),{padding:[20,20]})}return()=>{o&&o.remove()}});function x(D){(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),c()())}oe();var b=sa(),n=p(b);fe(n,D=>M(u,D),()=>h(u));var v=T(n,2),l=p(v),m=p(l),f=p(m),w=p(f,!0);g(f);var _=T(f,2),d=p(_);g(_),g(m),g(l);var i=T(l,2),k=p(i),y=p(k),L=p(y,!0);g(y),se(2),g(k);var E=T(k,2),R=p(E),j=p(R,!0);g(R),se(2),g(E);var P=T(E,2),$=p(P),W=p($);g($),se(2),g(P),g(i);var q=T(i,2),H=p(q),re=T(H,2);g(q),g(v),g(b),ve((D,I,ne,le)=>{O(w,D),O(d,`${a().startTime??""} - ${a().endTime??""}`),O(L,I),O(j,ne),O(W,`${le??""} km/h`)},[()=>new Date(a().date).toLocaleDateString(),()=>Ie(a().distance),()=>Re(a().duration),()=>a().avgSpeed.toFixed(1)],be),B("click",H,Fe(function(...D){var I;(I=s())==null||I.apply(this,D)})),B("click",re,Fe(function(...D){var I;(I=r())==null||I.apply(this,D)})),B("click",b,function(...D){var I;(I=c())==null||I.apply(this,D)}),B("keydown",b,x),A(t,b),ae()}const Ae="mapme_routes";function ca(t){if(typeof window>"u")return;const e=ee();e.unshift(t),localStorage.setItem(Ae,JSON.stringify(e))}function ee(){if(typeof window>"u")return[];const t=localStorage.getItem(Ae);return t?JSON.parse(t):[]}function da(t){if(typeof window>"u")return;const a=ee().filter(c=>c.id!==t);localStorage.setItem(Ae,JSON.stringify(a))}var ua=z('<div class="text-center py-16 px-5 text-gray-500"><p>No routes recorded yet.</p> <p>Tap the map tab to start tracking!</p></div>'),va=z('<div class="h-full overflow-y-auto bg-gray-100 relative"><div class="bg-white p-5 shadow-lg sticky top-0 z-[500]"><h1 class="text-2xl font-bold m-0">Your Routes</h1></div> <div class="p-4 flex flex-col gap-4 pb-24"><!></div></div>');function fa(t,e){te(e,!1);const[a,c]=ge(),s=()=>he(Z,"$appState",a);let r=C(e,"onViewRoute",8,()=>{}),o=C(e,"onExportRoute",8,()=>{}),u=N([]);pe(()=>{M(u,ee())});function x(_){confirm("Delete this route?")&&(da(_),M(u,ee()))}function b(){console.log("Refreshing routes list..."),M(u,ee()),console.log("Current routes:",h(u))}Ye(()=>(s(),ee),()=>{s()==="history"&&M(u,ee())}),Je(),oe();var n=va(),v=T(p(n),2),l=p(v);{var m=_=>{var d=ua();A(_,d)},f=_=>{var d=Ze(),i=xe(d);zt(i,1,()=>h(u),k=>k.id,(k,y)=>{la(k,{get route(){return h(y)},onView:()=>r()(h(y)),onExport:()=>o()(h(y)),onDelete:()=>x(h(y).id)})}),A(_,d)};F(l,_=>{h(u).length===0?_(m):_(f,!1)})}g(v),g(n),A(t,n),De(e,"refresh",b);var w=ae({refresh:b});return c(),w}var pa=z('<div class="h-screen flex flex-col"><div class="bg-white p-5 shadow-md z-[100] sm:p-4"><button class="bg-transparent border-none text-blue-500 text-base cursor-pointer mb-4 p-1 hover:underline">← Back to Routes</button> <div class="mb-5"><h1 class="text-2xl font-bold m-0 mb-1 text-gray-800"> </h1> <p class="text-base text-gray-500 m-0"> </p> <p class="text-sm text-gray-400 mt-1 mb-0"> </p></div> <div class="flex gap-8 sm:gap-5"><div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Distance</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Duration</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Avg Speed</span></div></div></div> <div class="flex-1 relative"><div class="w-full h-full"></div></div></div>');function ga(t,e){te(e,!1);const[a,c]=ge();let s=C(e,"route",8),r,o,u=N();pe(async()=>{o=await Me(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(h(u),{zoomControl:!0,dragging:!0,touchZoom:!0,scrollWheelZoom:!0,doubleClickZoom:!0}),o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(r);const D=o.polyline(s().positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r);return o.marker(s().positions[0]).addTo(r).bindPopup("Start: "+s().startTime).openPopup(),o.marker(s().positions[s().positions.length-1]).addTo(r).bindPopup("End: "+s().endTime),r.fitBounds(D.getBounds(),{padding:[50,50]}),()=>{r&&r.remove()}});function x(){Q(Z,"history")}oe();var b=pa(),n=p(b),v=p(n),l=T(v,2),m=p(l),f=p(m,!0);g(m);var w=T(m,2),_=p(w,!0);g(w);var d=T(w,2),i=p(d);g(d),g(l);var k=T(l,2),y=p(k),L=p(y),E=p(L,!0);g(L),se(2),g(y);var R=T(y,2),j=p(R),P=p(j,!0);g(j),se(2),g(R);var $=T(R,2),W=p($),q=p(W);g(W),se(2),g($),g(k),g(n);var H=T(n,2),re=p(H);fe(re,D=>M(u,D),()=>h(u)),g(H),g(b),ve((D,I,ne,le)=>{O(f,s().name),O(_,D),O(i,`${s().startTime??""} - ${s().endTime??""}`),O(E,I),O(P,ne),O(q,`${le??""} km/h`)},[()=>new Date(s().date).toLocaleDateString(),()=>Ie(s().distance),()=>Re(s().duration),()=>s().avgSpeed.toFixed(1)],be),B("click",v,x),A(t,b),ae(),c()}var ma=z('<div class="fixed bottom-0 right-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Routes</button></div>'),ha=z('<div class="fixed bottom-0 right-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Map</button></div>');function ba(t,e){te(e,!1);const[a,c]=ge(),s=()=>he(Z,"$appState",a);let r=C(e,"onHistoryClick",8,()=>{});oe();var o=Ze(),u=xe(o);{var x=n=>{var v=ma(),l=p(v);g(v),B("click",l,()=>{Q(Z,"history"),r()()}),A(n,v)},b=(n,v)=>{{var l=m=>{var f=ha(),w=p(f);g(f),B("click",w,()=>Q(Z,"idle")),A(m,f)};F(n,m=>{s()==="history"&&m(l)},v)}};F(u,n=>{s()==="idle"?n(x):n(b,!1)})}A(t,o),ae(),c()}var xa=z('<div class="w-screen h-screen overflow-hidden relative flex flex-col"><div class="flex-1 relative overflow-hidden"><!></div> <!></div>');function Ea(t,e){te(e,!1);const[a,c]=ge(),s=()=>he(Z,"$appState",a),r=()=>he(He,"$selectedRoute",a);let o=N(),u=N();function x(i){const k=i.detail;console.log("Route complete:",k);const y={id:Wt(),name:`Route ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`,...k,date:Zt()};console.log("Saving route:",y),ca(y),Q(Z,"history")}function b(i){Q(He,i),Q(Z,"viewing-route")}function n(i){const k=v(i),y=new Blob([k],{type:"application/gpx+xml"}),L=URL.createObjectURL(y),E=document.createElement("a");E.href=L,E.download=`route_${i.date.split("T")[0]}.gpx`,E.click(),URL.revokeObjectURL(L)}function v(i){const k=i.positions.map((y,L)=>{var R;const E=(R=i.timestamps)!=null&&R[L]?new Date(i.timestamps[L]).toISOString():new Date(i.date).toISOString();return`<trkpt lat="${y[0]}" lon="${y[1]}">
				<time>${E}</time>
			</trkpt>`}).join(`
			`);return`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapMe">
	<metadata>
		<name>${i.name}</name>
		<time>${i.date}</time>
	</metadata>
	<trk>
		<name>${i.name}</name>
		<trkseg>
			${k}
		</trkseg>
	</trk>
</gpx>`}Ye(()=>(s(),h(o)),()=>{s()==="idle"&&h(o)&&h(o).invalidateSize()}),Je(),oe();var l=xa(),m=p(l),f=p(m);{var w=i=>{fe(ia(i,{$$events:{routeComplete:x},$$legacy:!0}),k=>M(o,k),()=>h(o))},_=(i,k)=>{{var y=E=>{fe(fa(E,{onViewRoute:b,onExportRoute:n,$$legacy:!0}),R=>M(u,R),()=>h(u))},L=(E,R)=>{{var j=P=>{ga(P,{get route(){return r()}})};F(E,P=>{s()==="viewing-route"&&r()&&P(j)},R)}};F(i,E=>{s()==="history"?E(y):E(L,!1)},k)}};F(f,i=>{s()==="idle"||s()==="tracking"?i(w):i(_,!1)})}g(m);var d=T(m,2);ba(d,{}),g(l),A(t,l),ae(),c()}export{Ea as component};
