import{f as z,a as A,c as Ut}from"../chunks/C7mDw3il.js";import"../chunks/B0R5ntbu.js";import{m as Z,n as ee,X as ae,g as h,ab as mt,Z as oe,_ as re,$ as Ct,G as Pt,F as St,I as ut,J as ne,a0 as Ft,Q as Ht,a1 as ie,N as Zt,y as se,a6 as N,ao as zt,ap as kt,w as $t,aq as le,ar as de,as as ce,M as ue,at as ve,au as fe,av as pe,aw as ge,D as me,ax as he,ay as be,az as xe,aA as _e,a8 as ye,z as we,p as et,k as p,s as T,l as g,t as ht,j as at,i as bt,a7 as R,aB as nt,aC as Gt,aD as qt}from"../chunks/D_9gYwmd.js";import{p as C,i as F,_ as Et,s as ft,b as vt,a as J,c as gt}from"../chunks/oce6cgei.js";import{i as ot}from"../chunks/B-Ci0uq9.js";import{w as Wt,c as Se,o as xt,a as ke}from"../chunks/SChdK5eF.js";import{s as O,e as j}from"../chunks/C0-CMGp8.js";function Te(e,t,a,d){for(var s=[],r=t.length,o=0;o<r;o++)ce(t[o].e,s,!0);var u=r>0&&s.length===0&&a!==null;if(u){var x=a.parentNode;ue(x),x.append(a),d.clear(),Y(e,t[0].prev,t[r-1].next)}ve(s,()=>{for(var b=0;b<r;b++){var n=t[b];u||(d.delete(n.k),Y(e,n.prev,n.next)),fe(n.e,!u)}})}function De(e,t,a,d,s,r=null){var o=e,u={flags:t,items:new Map,first:null};Z&&ee();var x=null,b=!1,n=mt(()=>{var v=a();return se(v)?v:v==null?[]:Zt(v)});ae(()=>{var v=h(n),l=v.length;if(b&&l===0)return;b=l===0;let m=!1;if(Z){var f=oe(o)===re;f!==(l===0)&&(o=Ct(),Pt(o),St(!1),m=!0)}if(Z){for(var w=null,_,c=0;c<l;c++){if(ut.nodeType===8&&ut.data===ne){o=ut,m=!0,St(!1);break}var i=v[c],S=d(i,c);_=Yt(ut,u,w,null,i,S,c,s,t,a),u.items.set(S,_),w=_}l>0&&Pt(Ct())}Z||Ee(v,u,o,s,t,d,a),r!==null&&(l===0?x?Ft(x):x=Ht(()=>r(o)):x!==null&&ie(x,()=>{x=null})),m&&St(!0),h(n)}),Z&&(o=ut)}function Ee(e,t,a,d,s,r,o){var u=e.length,x=t.items,b=t.first,n=b,v,l=null,m=[],f=[],w,_,c,i;for(i=0;i<u;i+=1){if(w=e[i],_=r(w,i),c=x.get(_),c===void 0){var S=n?n.e.nodes_start:a;l=Yt(S,t,l,l===null?t.first:l.next,w,_,i,d,s,o),x.set(_,l),m=[],f=[],n=l.next;continue}if(Me(c,w,i),(c.e.f&kt)!==0&&Ft(c.e),c!==n){if(v!==void 0&&v.has(c)){if(m.length<f.length){var y=f[0],k;l=y.prev;var D=m[0],L=m[m.length-1];for(k=0;k<m.length;k+=1)Nt(m[k],y,a);for(k=0;k<f.length;k+=1)v.delete(f[k]);Y(t,D.prev,L.next),Y(t,l,D),Y(t,L,y),n=y,l=L,i-=1,m=[],f=[]}else v.delete(c),Nt(c,n,a),Y(t,c.prev,c.next),Y(t,c,l===null?t.first:l.next),Y(t,l,c),l=c;continue}for(m=[],f=[];n!==null&&n.k!==_;)(n.e.f&kt)===0&&(v??(v=new Set)).add(n),f.push(n),n=n.next;if(n===null)continue;c=n}m.push(c),l=c,n=c.next}if(n!==null||v!==void 0){for(var $=v===void 0?[]:Zt(v);n!==null;)(n.e.f&kt)===0&&$.push(n),n=n.next;var P=$.length;if(P>0){var V=null;Te(t,$,V,x)}}$t.first=t.first&&t.first.e,$t.last=l&&l.e}function Me(e,t,a,d){de(e.v,t),e.i=a}function Yt(e,t,a,d,s,r,o,u,x,b){var n=(x&pe)!==0,v=(x&ge)===0,l=n?v?N(s):zt(s):s,m=(x&le)===0?o:zt(o),f={i:m,v:l,k:r,a:null,e:null,prev:a,next:d};try{return f.e=Ht(()=>u(e,l,m,b),Z),f.e.prev=a&&a.e,f.e.next=d&&d.e,a===null?t.first=f:(a.next=f,a.e.next=f.e),d!==null&&(d.prev=f,d.e.prev=f.e),f}finally{}}function Nt(e,t,a){for(var d=e.next?e.next.e.nodes_start:a,s=t?t.e.nodes_start:a,r=e.e.nodes_start;r!==d;){var o=me(r);s.before(r),r=o}}function Y(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Re(e,t,a){var d=e==null?"":""+e;return d===""?null:d}function Tt(e,t,a,d,s,r){var o=e.__className;if(Z||o!==a||o===void 0){var u=Re(a);(!Z||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):e.className=u),e.__className=a}return r}const Le=Symbol("is custom element"),Ie=Symbol("is html");function Ot(e,t,a,d){var s=Ae(e);Z&&(s[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||s[t]!==(s[t]=a)&&(t==="loading"&&(e[he]=a),a==null?e.removeAttribute(t):typeof a!="string"&&Ce(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Ae(e){return e.__attributes??(e.__attributes={[Le]:e.nodeName.includes("-"),[Ie]:e.namespaceURI===be})}var jt=new Map;function Ce(e){var t=jt.get(e.nodeName);if(t)return t;jt.set(e.nodeName,t=[]);for(var a,d=e,s=Element.prototype;s!==d;){a=_e(d);for(var r in a)a[r].set&&t.push(r);d=xe(d)}return t}function Dt(e,t,a){var d=ye(e,t);d&&d.set&&(e[t]=a,we(()=>{e[t]=null}))}function Bt(e){return function(...t){var a=t[0];return a.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Pe(e){let t=0;for(let a=1;a<e.length;a++){const[d,s]=e[a-1],[r,o]=e[a],u=6371,x=(r-d)*Math.PI/180,b=(o-s)*Math.PI/180,n=Math.sin(x/2)*Math.sin(x/2)+Math.cos(d*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(b/2)*Math.sin(b/2),v=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),l=u*v;t+=l}return t}function ze(e,t){return t===0?0:e/t*3600}function Mt(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),d=Math.floor(e%60);return t>0?`${t}h ${a}m ${d}s`:a>0?`${a}m ${d}s`:`${d}s`}function Rt(e){return e<1?`${Math.round(e*1e3)}m`:`${e.toFixed(2)}km`}function $e(){return new Date().toISOString()}function Ne(){return`route_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}var Oe=z('<div class="absolute top-2.5 left-2.5 bg-white/95 p-4 rounded-xl shadow-md z-[400] min-w-[200px] sm:top-[60px] sm:left-2.5 sm:right-2.5 sm:min-w-0"><div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Time:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Distance:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Current Speed:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Avg Speed:</span> <span class="font-bold text-gray-800"> </span></div></div>');function je(e,t){et(t,!1);let a=C(t,"elapsedTime",8,0),d=C(t,"distance",8,0),s=C(t,"currentSpeed",8,0),r=C(t,"avgSpeed",8,0);ot();var o=Oe(),u=p(o),x=T(p(u),2),b=p(x,!0);g(x),g(u);var n=T(u,2),v=T(p(n),2),l=p(v,!0);g(v),g(n);var m=T(n,2),f=T(p(m),2),w=p(f);g(f),g(m);var _=T(m,2),c=T(p(_),2),i=p(c);g(c),g(_),g(o),ht((S,y,k,D)=>{O(b,S),O(l,y),O(w,`${k??""} km/h`),O(i,`${D??""} km/h`)},[()=>Mt(a()),()=>Rt(d()),()=>s().toFixed(1),()=>r().toFixed(1)],mt),A(e,o),at()}var Be=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-green-500 hover:bg-green-600">Start Tracking</button>'),Ve=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-amber-500 hover:bg-amber-600">Pause</button>'),Ue=z('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-blue-500 hover:bg-blue-600">Resume</button>'),Fe=z('<!> <button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-red-500 hover:bg-red-600">Stop</button>',1),He=z('<div class="fixed bottom-0 left-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><!></div>');function Ze(e,t){let a=C(t,"tracking",8,!1),d=C(t,"paused",8,!1),s=C(t,"onStart",8,()=>{}),r=C(t,"onPause",8,()=>{}),o=C(t,"onStop",8,()=>{});var u=He(),x=p(u);{var b=v=>{var l=Be();j("click",l,function(...m){var f;(f=s())==null||f.apply(this,m)}),A(v,l)},n=v=>{var l=Fe(),m=bt(l);{var f=c=>{var i=Ve();j("click",i,function(...S){var y;(y=r())==null||y.apply(this,S)}),A(c,i)},w=c=>{var i=Ue();j("click",i,function(...S){var y;(y=r())==null||y.apply(this,S)}),A(c,i)};F(m,c=>{d()?c(w,!1):c(f)})}var _=T(m,2);j("click",_,function(...c){var i;(i=o())==null||i.apply(this,c)}),A(v,l)};F(x,v=>{a()?v(n,!1):v(b)})}g(u),A(e,u)}const H=Wt("idle"),Vt=Wt(null);var Ge=z('<div class="w-full h-full flex items-center justify-center bg-gray-50"><div class="text-center p-8"><svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <h2 class="text-xl font-semibold text-gray-700 mb-2">Location Access Required</h2> <p class="text-gray-500 mb-4">Please enable location services to use MapMe</p> <button class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">Retry</button></div></div>'),qe=z('<div class="w-full h-full flex items-center justify-center bg-gray-50"><div class="text-center"><div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div> <p class="mt-4 text-gray-600">Finding your location...</p></div></div>'),We=z('<div id="map" class="w-full h-full"></div> <!> <div class="absolute top-2.5 right-[60px] flex flex-col gap-2.5 z-[400]"><button><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></svg></button></div> <div class="absolute top-2.5 left-2.5 flex gap-1.5 z-[400] bg-white/90 p-1.5 rounded-lg"><button>Street</button> <button>Satellite</button></div> <!>',1),Ye=z('<div class="w-full h-full relative"><!></div>');function Je(e,t){et(t,!1);const[a,d]=ft(),s=Se();let r,o,u,x=N(),b=N("street"),n=N(!0),v=N(!1),l=N(!1),m=C(t,"tracking",12,!1),f=C(t,"paused",12,!1),w=[],_=[],c=null,i=null,S=null,y=null,k=N(0),D=N(0),L=N(0),$=N(0),P=null;const V={street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"}};xt(async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async M=>{const{latitude:B,longitude:U}=M.coords;R(v,!0),o=await Et(()=>import("../chunks/r9KgTLRM.js").then(q=>q.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(h(x),{zoomControl:!1}).setView([B,U],16),o.control.zoom({position:"topright"}).addTo(r),u=o.tileLayer(V[h(b)].url,{attribution:V[h(b)].attribution,maxZoom:19}).addTo(r),S=o.marker([B,U]).addTo(r).bindPopup("Current location")},M=>{console.error("Error getting location:",M),R(l,!0)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4}):R(l,!0)}),ke(()=>{c!==null&&navigator.geolocation.clearWatch(c),P!==null&&clearInterval(P),r&&r.remove()});function K(){r&&setTimeout(()=>{r.invalidateSize()},100)}function X(M){!r||!o||(i&&r.removeLayer(i),i=o.polyline(M.positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r),o.marker(M.positions[0]).addTo(r).bindPopup("Start").openPopup(),o.marker(M.positions[M.positions.length-1]).addTo(r).bindPopup("End"),r.fitBounds(i.getBounds(),{padding:[50,50]}))}function G(M){!o||!r||(R(b,M),u&&(r.removeLayer(u),u=o.tileLayer(V[h(b)].url,{attribution:V[h(b)].attribution,maxZoom:19}).addTo(r)))}function it(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}J(H,"tracking"),m(!0),f(!1),w=[],_=[],y=Date.now(),P=setInterval(()=>{f()||R(k,Math.floor((Date.now()-y)/1e3))},1e3),c=navigator.geolocation.watchPosition(M=>{if(f())return;const{latitude:B,longitude:U,speed:q,accuracy:W}=M.coords;if(W>50)return;const rt=5;let lt=!0;if(w.length>0){const dt=w[w.length-1];lt=o.latLng(dt[0],dt[1]).distanceTo(o.latLng(B,U))>=rt}S&&S.setLatLng([B,U]),lt&&(w=[...w,[B,U]],_=[..._,Date.now()],w.length>1&&(R(D,Pe(w)),R($,ze(h(D),h(k))),R(L,q?q*3.6:0)),w.length>1&&(i?i.setLatLngs(w):i=o.polyline(w,{color:"#3B82F6",weight:5,opacity:.8,smoothFactor:1}).addTo(r))),h(n)&&r.setView([B,U],r.getZoom(),{animate:!0,duration:.5})},M=>{console.error("Error tracking position:",M)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})}function E(){f(!f()),f()&&(y+=Date.now()-(y+h(k)*1e3))}function I(){if(J(H,"idle"),m(!1),f(!1),c!==null&&(navigator.geolocation.clearWatch(c),c=null),P!==null&&(clearInterval(P),P=null),w.length>1){const M={positions:w,timestamps:_,distance:h(D),duration:h(k),avgSpeed:h($),startTime:new Date(_[0]).toLocaleTimeString(),endTime:new Date(_[_.length-1]).toLocaleTimeString()};console.log("Dispatching route complete event:",M),s("routeComplete",M),i&&(r.removeLayer(i),i=null),w=[],_=[],R(D,0),R(k,0),R(L,0),R($,0)}}function st(){R(n,!h(n))}ot();var Q=Ye(),Jt=p(Q);{var Kt=M=>{var B=Ge(),U=p(B),q=T(p(U),6);g(U),g(B),j("click",q,()=>window.location.reload()),A(M,B)},Xt=(M,B)=>{{var U=W=>{var rt=qe();A(W,rt)},q=W=>{var rt=We(),lt=bt(rt);vt(lt,ct=>R(x,ct),()=>h(x));var dt=T(lt,2);{var It=ct=>{je(ct,{get elapsedTime(){return h(k)},get distance(){return h(D)},get currentSpeed(){return h(L)},get avgSpeed(){return h($)}})};F(dt,ct=>{m()&&ct(It)})}var _t=T(dt,2),pt=p(_t);g(_t);var yt=T(_t,2),wt=p(yt),At=T(wt,2);g(yt);var te=T(yt,2);Ze(te,{get tracking(){return m()},get paused(){return f()},onStart:it,onPause:E,onStop:I}),ht(()=>{Tt(pt,1,`border-none w-10 h-10 rounded-lg cursor-pointer shadow-md flex items-center justify-center transition-all duration-200 hover:scale-105 ${h(n)?"bg-blue-500 text-white hover:bg-blue-600":"bg-white text-gray-700 hover:bg-gray-100"}`),Ot(pt,"title",`${h(n)?"Disable":"Enable"} location following`),Ot(pt,"aria-label",`${h(n)?"Disable":"Enable"} location following`),Tt(wt,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${h(b)==="street"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`),Tt(At,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${h(b)==="satellite"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`)}),j("click",pt,st),j("click",wt,()=>G("street")),j("click",At,()=>G("satellite")),A(W,rt)};F(M,W=>{h(v)?W(q,!1):W(U)},B)}};F(Jt,M=>{h(l)?M(Kt):M(Xt,!1)})}g(Q),A(e,Q),Dt(t,"invalidateSize",K),Dt(t,"showRoute",X);var Qt=at({invalidateSize:K,showRoute:X});return d(),Qt}var Ke=z('<div class="bg-white rounded-2xl overflow-hidden shadow-md cursor-pointer transition-all duration-200 outline-none hover:-translate-y-0.5 hover:shadow-lg focus:outline-2 focus:outline-offset-2 focus:outline-blue-500" role="button" tabindex="0" aria-label="View route details"><div class="w-full h-[150px] bg-gray-200"></div> <div class="p-4"><div class="flex justify-between items-start mb-2.5"><div><div class="text-base font-semibold text-gray-800"> </div> <div class="text-sm text-gray-500"> </div></div></div> <div class="grid grid-cols-3 gap-2.5 mb-2.5"><div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Distance</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Duration</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Avg Speed</div></div></div> <div class="flex gap-2.5 mt-2.5"><button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-blue-100 text-blue-700 hover:bg-blue-200">Export</button> <button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-red-100 text-red-700 hover:bg-red-200">Delete</button></div></div></div>');function Xe(e,t){et(t,!1);let a=C(t,"route",8),d=C(t,"onView",8,()=>{}),s=C(t,"onExport",8,()=>{}),r=C(t,"onDelete",8,()=>{}),o,u=N();xt(async()=>{const E=await Et(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url);if(h(u)){o=E.map(h(u),{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1}),E.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(o);const I=E.polyline(a().positions,{color:"#3B82F6",weight:3,opacity:.8}).addTo(o);o.fitBounds(I.getBounds(),{padding:[20,20]})}return()=>{o&&o.remove()}});function x(E){(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),d()())}ot();var b=Ke(),n=p(b);vt(n,E=>R(u,E),()=>h(u));var v=T(n,2),l=p(v),m=p(l),f=p(m),w=p(f,!0);g(f);var _=T(f,2),c=p(_);g(_),g(m),g(l);var i=T(l,2),S=p(i),y=p(S),k=p(y,!0);g(y),nt(2),g(S);var D=T(S,2),L=p(D),$=p(L,!0);g(L),nt(2),g(D);var P=T(D,2),V=p(P),K=p(V);g(V),nt(2),g(P),g(i);var X=T(i,2),G=p(X),it=T(G,2);g(X),g(v),g(b),ht((E,I,st,Q)=>{O(w,E),O(c,`${a().startTime??""} - ${a().endTime??""}`),O(k,I),O($,st),O(K,`${Q??""} km/h`)},[()=>new Date(a().date).toLocaleDateString(),()=>Rt(a().distance),()=>Mt(a().duration),()=>a().avgSpeed.toFixed(1)],mt),j("click",G,Bt(function(...E){var I;(I=s())==null||I.apply(this,E)})),j("click",it,Bt(function(...E){var I;(I=r())==null||I.apply(this,E)})),j("click",b,function(...E){var I;(I=d())==null||I.apply(this,E)}),j("keydown",b,x),A(e,b),at()}const Lt="mapme_routes";function Qe(e){if(typeof window>"u")return;const t=tt();t.unshift(e),localStorage.setItem(Lt,JSON.stringify(t))}function tt(){if(typeof window>"u")return[];const e=localStorage.getItem(Lt);return e?JSON.parse(e):[]}function ta(e){if(typeof window>"u")return;const a=tt().filter(d=>d.id!==e);localStorage.setItem(Lt,JSON.stringify(a))}var ea=z('<div class="text-center py-16 px-5 text-gray-500"><p>No routes recorded yet.</p> <p>Tap the map tab to start tracking!</p></div>'),aa=z('<div class="h-full overflow-y-auto bg-gray-100 relative"><div class="bg-white p-5 shadow-lg sticky top-0 z-[500]"><h1 class="text-2xl font-bold m-0">Your Routes</h1></div> <div class="p-4 flex flex-col gap-4 pb-24"><!></div></div>');function oa(e,t){et(t,!1);const[a,d]=ft(),s=()=>gt(H,"$appState",a);let r=C(t,"onViewRoute",8,()=>{}),o=C(t,"onExportRoute",8,()=>{}),u=N([]);xt(()=>{R(u,tt())});function x(_){confirm("Delete this route?")&&(ta(_),R(u,tt()))}function b(){console.log("Refreshing routes list..."),R(u,tt()),console.log("Current routes:",h(u))}Gt(()=>(s(),tt),()=>{s()==="history"&&R(u,tt())}),qt(),ot();var n=aa(),v=T(p(n),2),l=p(v);{var m=_=>{var c=ea();A(_,c)},f=_=>{var c=Ut(),i=bt(c);De(i,1,()=>h(u),S=>S.id,(S,y)=>{Xe(S,{get route(){return h(y)},onView:()=>r()(h(y)),onExport:()=>o()(h(y)),onDelete:()=>x(h(y).id)})}),A(_,c)};F(l,_=>{h(u).length===0?_(m):_(f,!1)})}g(v),g(n),A(e,n),Dt(t,"refresh",b);var w=at({refresh:b});return d(),w}var ra=z('<div class="h-screen flex flex-col"><div class="bg-white p-5 shadow-md z-[100] sm:p-4"><button class="bg-transparent border-none text-blue-500 text-base cursor-pointer mb-4 p-1 hover:underline">← Back to Routes</button> <div class="mb-5"><h1 class="text-2xl font-bold m-0 mb-1 text-gray-800"> </h1> <p class="text-base text-gray-500 m-0"> </p> <p class="text-sm text-gray-400 mt-1 mb-0"> </p></div> <div class="flex gap-8 sm:gap-5"><div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Distance</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Duration</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Avg Speed</span></div></div></div> <div class="flex-1 relative"><div class="w-full h-full"></div></div></div>');function na(e,t){et(t,!1);const[a,d]=ft();let s=C(t,"route",8),r,o,u=N();xt(async()=>{o=await Et(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(h(u),{zoomControl:!0,dragging:!0,touchZoom:!0,scrollWheelZoom:!0,doubleClickZoom:!0}),o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(r);const E=o.polyline(s().positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r);return o.marker(s().positions[0]).addTo(r).bindPopup("Start: "+s().startTime).openPopup(),o.marker(s().positions[s().positions.length-1]).addTo(r).bindPopup("End: "+s().endTime),r.fitBounds(E.getBounds(),{padding:[50,50]}),()=>{r&&r.remove()}});function x(){J(H,"history")}ot();var b=ra(),n=p(b),v=p(n),l=T(v,2),m=p(l),f=p(m,!0);g(m);var w=T(m,2),_=p(w,!0);g(w);var c=T(w,2),i=p(c);g(c),g(l);var S=T(l,2),y=p(S),k=p(y),D=p(k,!0);g(k),nt(2),g(y);var L=T(y,2),$=p(L),P=p($,!0);g($),nt(2),g(L);var V=T(L,2),K=p(V),X=p(K);g(K),nt(2),g(V),g(S),g(n);var G=T(n,2),it=p(G);vt(it,E=>R(u,E),()=>h(u)),g(G),g(b),ht((E,I,st,Q)=>{O(f,s().name),O(_,E),O(i,`${s().startTime??""} - ${s().endTime??""}`),O(D,I),O(P,st),O(X,`${Q??""} km/h`)},[()=>new Date(s().date).toLocaleDateString(),()=>Rt(s().distance),()=>Mt(s().duration),()=>s().avgSpeed.toFixed(1)],mt),j("click",v,x),A(e,b),at(),d()}var ia=z('<div class="fixed bottom-0 right-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Routes</button></div>'),sa=z('<div class="fixed bottom-0 right-0 p-5 pb-[calc(1.25rem+env(safe-area-inset-bottom))] flex gap-2.5 z-[400]"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Map</button></div>');function la(e,t){et(t,!1);const[a,d]=ft(),s=()=>gt(H,"$appState",a);let r=C(t,"onHistoryClick",8,()=>{});ot();var o=Ut(),u=bt(o);{var x=n=>{var v=ia(),l=p(v);g(v),j("click",l,()=>{J(H,"history"),r()()}),A(n,v)},b=(n,v)=>{{var l=m=>{var f=sa(),w=p(f);g(f),j("click",w,()=>J(H,"idle")),A(m,f)};F(n,m=>{s()==="history"&&m(l)},v)}};F(u,n=>{s()==="idle"?n(x):n(b,!1)})}A(e,o),at(),d()}var da=z('<div class="w-screen h-screen overflow-hidden relative flex flex-col"><div class="flex-1 relative overflow-hidden"><!></div> <!></div>');function ha(e,t){et(t,!1);const[a,d]=ft(),s=()=>gt(H,"$appState",a),r=()=>gt(Vt,"$selectedRoute",a);let o=N(),u=N();function x(i){const S=i.detail;console.log("Route complete:",S);const y={id:Ne(),name:`Route ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`,...S,date:$e()};console.log("Saving route:",y),Qe(y),J(H,"history")}function b(i){J(Vt,i),J(H,"viewing-route")}function n(i){const S=v(i),y=new Blob([S],{type:"application/gpx+xml"}),k=URL.createObjectURL(y),D=document.createElement("a");D.href=k,D.download=`route_${i.date.split("T")[0]}.gpx`,D.click(),URL.revokeObjectURL(k)}function v(i){const S=i.positions.map((y,k)=>{var L;const D=(L=i.timestamps)!=null&&L[k]?new Date(i.timestamps[k]).toISOString():new Date(i.date).toISOString();return`<trkpt lat="${y[0]}" lon="${y[1]}">
				<time>${D}</time>
			</trkpt>`}).join(`
			`);return`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapMe">
	<metadata>
		<name>${i.name}</name>
		<time>${i.date}</time>
	</metadata>
	<trk>
		<name>${i.name}</name>
		<trkseg>
			${S}
		</trkseg>
	</trk>
</gpx>`}Gt(()=>(s(),h(o)),()=>{s()==="idle"&&h(o)&&h(o).invalidateSize()}),qt(),ot();var l=da(),m=p(l),f=p(m);{var w=i=>{vt(Je(i,{$$events:{routeComplete:x},$$legacy:!0}),S=>R(o,S),()=>h(o))},_=(i,S)=>{{var y=D=>{vt(oa(D,{onViewRoute:b,onExportRoute:n,$$legacy:!0}),L=>R(u,L),()=>h(u))},k=(D,L)=>{{var $=P=>{na(P,{get route(){return r()}})};F(D,P=>{s()==="viewing-route"&&r()&&P($)},L)}};F(i,D=>{s()==="history"?D(y):D(k,!1)},S)}};F(f,i=>{s()==="idle"||s()==="tracking"?i(w):i(_,!1)})}g(m);var c=T(m,2);la(c,{}),g(l),A(e,l),at(),d()}export{ha as component};
