import{f as z,a as C,c as $t}from"../chunks/DTwATy8O.js";import"../chunks/riX81yCh.js";import{m as F,n as Gt,X as Wt,g as y,ab as ct,Z as qt,_ as Jt,$ as Rt,G as Et,F as mt,I as st,J as Yt,a0 as At,Q as Pt,a1 as Xt,N as zt,y as Kt,a6 as V,ao as Lt,ap as gt,w as It,aq as Qt,ar as te,as as ee,M as ae,at as ie,au as ne,av as se,aw as re,D as oe,a8 as le,z as ce,p as J,k as m,s as S,l as g,t as vt,j as Y,i as bt,a7 as M,ax as it,ay as Ot,az as Vt}from"../chunks/BEHf9mPD.js";import{p as j,i as U,_ as yt,b as rt,s as ot,a as H,c as lt}from"../chunks/B_j6-B1u.js";import{i as X}from"../chunks/x2ZJxrZn.js";import{w as Bt,c as ve,o as ut,a as ue}from"../chunks/DuUd9pFA.js";import{s as A,e as P}from"../chunks/CEGtxuwx.js";function de(e,t,a,c){for(var u=[],n=t.length,i=0;i<n;i++)ee(t[i].e,u,!0);var d=n>0&&u.length===0&&a!==null;if(d){var k=a.parentNode;ae(k),k.append(a),c.clear(),Z(e,t[0].prev,t[n-1].next)}ie(u,()=>{for(var _=0;_<n;_++){var s=t[_];d||(c.delete(s.k),Z(e,s.prev,s.next)),ne(s.e,!d)}})}function pe(e,t,a,c,u,n=null){var i=e,d={flags:t,items:new Map,first:null};F&&Gt();var k=null,_=!1,s=ct(()=>{var v=a();return Kt(v)?v:v==null?[]:zt(v)});Wt(()=>{var v=y(s),r=v.length;if(_&&r===0)return;_=r===0;let l=!1;if(F){var f=qt(i)===Jt;f!==(r===0)&&(i=Rt(),Et(i),mt(!1),l=!0)}if(F){for(var x=null,h,p=0;p<r;p++){if(st.nodeType===8&&st.data===Yt){i=st,l=!0,mt(!1);break}var o=v[p],w=c(o,p);h=Nt(st,d,x,null,o,w,p,u,t,a),d.items.set(w,h),x=h}r>0&&Et(Rt())}F||fe(v,d,i,u,t,c,a),n!==null&&(r===0?k?At(k):k=Pt(()=>n(i)):k!==null&&Xt(k,()=>{k=null})),l&&mt(!0),y(s)}),F&&(i=st)}function fe(e,t,a,c,u,n,i){var d=e.length,k=t.items,_=t.first,s=_,v,r=null,l=[],f=[],x,h,p,o;for(o=0;o<d;o+=1){if(x=e[o],h=n(x,o),p=k.get(h),p===void 0){var w=s?s.e.nodes_start:a;r=Nt(w,t,r,r===null?t.first:r.next,x,h,o,c,u,i),k.set(h,r),l=[],f=[],s=r.next;continue}if(me(p,x,o),(p.e.f&gt)!==0&&At(p.e),p!==s){if(v!==void 0&&v.has(p)){if(l.length<f.length){var b=f[0],D;r=b.prev;var T=l[0],L=l[l.length-1];for(D=0;D<l.length;D+=1)Mt(l[D],b,a);for(D=0;D<f.length;D+=1)v.delete(f[D]);Z(t,T.prev,L.next),Z(t,r,T),Z(t,L,b),s=b,r=L,o-=1,l=[],f=[]}else v.delete(p),Mt(p,s,a),Z(t,p.prev,p.next),Z(t,p,r===null?t.first:r.next),Z(t,r,p),r=p;continue}for(l=[],f=[];s!==null&&s.k!==h;)(s.e.f&gt)===0&&(v??(v=new Set)).add(s),f.push(s),s=s.next;if(s===null)continue;p=s}l.push(p),r=p,s=p.next}if(s!==null||v!==void 0){for(var $=v===void 0?[]:zt(v);s!==null;)(s.e.f&gt)===0&&$.push(s),s=s.next;var O=$.length;if(O>0){var B=null;de(t,$,B,k)}}It.first=t.first&&t.first.e,It.last=r&&r.e}function me(e,t,a,c){te(e.v,t),e.i=a}function Nt(e,t,a,c,u,n,i,d,k,_){var s=(k&se)!==0,v=(k&re)===0,r=s?v?V(u):Lt(u):u,l=(k&Qt)===0?i:Lt(i),f={i:l,v:r,k:n,a:null,e:null,prev:a,next:c};try{return f.e=Pt(()=>d(e,r,l,_),F),f.e.prev=a&&a.e,f.e.next=c&&c.e,a===null?t.first=f:(a.next=f,a.e.next=f.e),c!==null&&(c.prev=f,c.e.prev=f.e),f}finally{}}function Mt(e,t,a){for(var c=e.next?e.next.e.nodes_start:a,u=t?t.e.nodes_start:a,n=e.e.nodes_start;n!==c;){var i=oe(n);u.before(n),n=i}}function Z(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function ge(e,t,a){var c=e==null?"":""+e;return c=c?c+" "+t:t,c===""?null:c}function _t(e,t,a,c,u,n){var i=e.__className;if(F||i!==a||i===void 0){var d=ge(a,c);(!F||d!==e.getAttribute("class"))&&(d==null?e.removeAttribute("class"):e.className=d),e.__className=a}return n}function ht(e,t,a){var c=le(e,t);c&&c.set&&(e[t]=a,ce(()=>{e[t]=null}))}function jt(e){return function(...t){var a=t[0];return a.stopPropagation(),e==null?void 0:e.apply(this,t)}}function _e(e){let t=0;for(let a=1;a<e.length;a++){const[c,u]=e[a-1],[n,i]=e[a],d=6371,k=(n-c)*Math.PI/180,_=(i-u)*Math.PI/180,s=Math.sin(k/2)*Math.sin(k/2)+Math.cos(c*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(_/2)*Math.sin(_/2),v=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),r=d*v;t+=r}return t}function he(e,t){return t===0?0:e/t*3600}function kt(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),c=Math.floor(e%60);return t>0?`${t}h ${a}m ${c}s`:a>0?`${a}m ${c}s`:`${c}s`}function wt(e){return e<1?`${Math.round(e*1e3)}m`:`${e.toFixed(2)}km`}function be(){return new Date().toISOString()}function ye(){return`route_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}var ke=z('<div class="stats svelte-16jiip9"><div class="stat-item svelte-16jiip9"><span class="stat-label svelte-16jiip9">Time:</span> <span class="stat-value svelte-16jiip9"> </span></div> <div class="stat-item svelte-16jiip9"><span class="stat-label svelte-16jiip9">Distance:</span> <span class="stat-value svelte-16jiip9"> </span></div> <div class="stat-item svelte-16jiip9"><span class="stat-label svelte-16jiip9">Current Speed:</span> <span class="stat-value svelte-16jiip9"> </span></div> <div class="stat-item svelte-16jiip9"><span class="stat-label svelte-16jiip9">Avg Speed:</span> <span class="stat-value svelte-16jiip9"> </span></div></div>');function we(e,t){J(t,!1);let a=j(t,"elapsedTime",8,0),c=j(t,"distance",8,0),u=j(t,"currentSpeed",8,0),n=j(t,"avgSpeed",8,0);X();var i=ke(),d=m(i),k=S(m(d),2),_=m(k,!0);g(k),g(d);var s=S(d,2),v=S(m(s),2),r=m(v,!0);g(v),g(s);var l=S(s,2),f=S(m(l),2),x=m(f);g(f),g(l);var h=S(l,2),p=S(m(h),2),o=m(p);g(p),g(h),g(i),vt((w,b,D,T)=>{A(_,w),A(r,b),A(x,`${D??""} km/h`),A(o,`${T??""} km/h`)},[()=>kt(a()),()=>wt(c()),()=>u().toFixed(1),()=>n().toFixed(1)],ct),C(e,i),Y()}var xe=z('<button class="control-button start svelte-k7tm8h">Start Tracking</button>'),Se=z('<button class="control-button pause svelte-k7tm8h">Pause</button>'),Te=z('<button class="control-button resume svelte-k7tm8h">Resume</button>'),De=z('<!> <button class="control-button stop svelte-k7tm8h">Stop</button>',1),Re=z('<div class="controls svelte-k7tm8h"><!></div>');function Ee(e,t){let a=j(t,"tracking",8,!1),c=j(t,"paused",8,!1),u=j(t,"onStart",8,()=>{}),n=j(t,"onPause",8,()=>{}),i=j(t,"onStop",8,()=>{});var d=Re(),k=m(d);{var _=v=>{var r=xe();P("click",r,function(...l){var f;(f=u())==null||f.apply(this,l)}),C(v,r)},s=v=>{var r=De(),l=bt(r);{var f=p=>{var o=Se();P("click",o,function(...w){var b;(b=n())==null||b.apply(this,w)}),C(p,o)},x=p=>{var o=Te();P("click",o,function(...w){var b;(b=n())==null||b.apply(this,w)}),C(p,o)};U(l,p=>{c()?p(x,!1):p(f)})}var h=S(l,2);P("click",h,function(...p){var o;(o=i())==null||o.apply(this,p)}),C(v,r)};U(k,v=>{a()?v(s,!1):v(_)})}g(d),C(e,d)}const N=Bt("idle"),Ct=Bt(null);var Le=z('<div class="map-container svelte-wdx2yi"><div id="map" class="svelte-wdx2yi"></div> <!> <div class="map-controls svelte-wdx2yi"><button title="Auto-center">üìç</button></div> <div class="map-styles svelte-wdx2yi"><button>Street</button> <button>Satellite</button></div> <!></div>');function Ie(e,t){J(t,!1);const[a,c]=ot(),u=ve();let n,i,d,k=V(),_=V("street"),s=V(!0),v=j(t,"tracking",12,!1),r=j(t,"paused",12,!1),l=[],f=[],x=null,h=null,p=null,o=null,w=V(0),b=V(0),D=V(0),T=V(0),L=null;const $={street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"¬© OpenStreetMap contributors"},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"¬© Esri"}};ut(async()=>{i=await yt(()=>import("../chunks/r9KgTLRM.js").then(E=>E.l),[],import.meta.url),delete i.Icon.Default.prototype._getIconUrl,i.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),n=i.map(y(k),{zoomControl:!1}).setView([40.7128,-74.006],13),i.control.zoom({position:"topright"}).addTo(n),d=i.tileLayer($[y(_)].url,{attribution:$[y(_)].attribution,maxZoom:19}).addTo(n),navigator.geolocation&&navigator.geolocation.getCurrentPosition(E=>{const{latitude:et,longitude:at}=E.coords;n.setView([et,at],16),p=i.marker([et,at]).addTo(n).bindPopup("Current location")},E=>{console.error("Error getting location:",E)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),ue(()=>{x!==null&&navigator.geolocation.clearWatch(x),L!==null&&clearInterval(L),n&&n.remove()});function O(){n&&setTimeout(()=>{n.invalidateSize()},100)}function B(E){!n||!i||(h&&n.removeLayer(h),h=i.polyline(E.positions,{color:"#10B981",weight:5,opacity:.8}).addTo(n),i.marker(E.positions[0]).addTo(n).bindPopup("Start").openPopup(),i.marker(E.positions[E.positions.length-1]).addTo(n).bindPopup("End"),n.fitBounds(h.getBounds(),{padding:[50,50]}))}function G(E){!i||!n||(M(_,E),d&&(n.removeLayer(d),d=i.tileLayer($[y(_)].url,{attribution:$[y(_)].attribution,maxZoom:19}).addTo(n)))}function K(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}H(N,"tracking"),v(!0),r(!1),l=[],f=[],o=Date.now(),L=setInterval(()=>{r()||M(w,Math.floor((Date.now()-o)/1e3))},1e3),x=navigator.geolocation.watchPosition(E=>{if(r())return;const{latitude:et,longitude:at,speed:Dt,accuracy:Ht}=E.coords;Ht>50||(l=[...l,[et,at]],f=[...f,Date.now()],p&&p.setLatLng([et,at]),l.length>1&&(M(b,_e(l)),M(T,he(y(b),y(w))),M(D,Dt?Dt*3.6:0)),l.length>1&&(h?h.setLatLngs(l):h=i.polyline(l,{color:"#3B82F6",weight:5,opacity:.8,smoothFactor:1}).addTo(n)),y(s)&&n.setView([et,at],n.getZoom(),{animate:!0,duration:.5}))},E=>{console.error("Error tracking position:",E)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})}function W(){r(!r()),r()&&(o+=Date.now()-(o+y(w)*1e3))}function nt(){if(H(N,"idle"),v(!1),r(!1),x!==null&&(navigator.geolocation.clearWatch(x),x=null),L!==null&&(clearInterval(L),L=null),l.length>1){const E={positions:l,timestamps:f,distance:y(b),duration:y(w),avgSpeed:y(T),startTime:new Date(f[0]).toLocaleTimeString(),endTime:new Date(f[f.length-1]).toLocaleTimeString()};console.log("Dispatching route complete event:",E),u("routeComplete",E),h&&(n.removeLayer(h),h=null),l=[],f=[],M(b,0),M(w,0),M(D,0),M(T,0)}}function R(){M(s,!y(s))}X();var I=Le(),Q=m(I);rt(Q,E=>M(k,E),()=>y(k));var tt=S(Q,2);{var Ut=E=>{we(E,{get elapsedTime(){return y(w)},get distance(){return y(b)},get currentSpeed(){return y(D)},get avgSpeed(){return y(T)}})};U(tt,E=>{v()&&E(Ut)})}var dt=S(tt,2),St=m(dt);g(dt);var pt=S(dt,2),ft=m(pt),Tt=S(ft,2);g(pt);var Zt=S(pt,2);Ee(Zt,{get tracking(){return v()},get paused(){return r()},onStart:K,onPause:W,onStop:nt}),g(I),vt(()=>{_t(St,1,`map-control ${y(s)?"active":""}`,"svelte-wdx2yi"),_t(ft,1,`style-button ${y(_)==="street"?"active":""}`,"svelte-wdx2yi"),_t(Tt,1,`style-button ${y(_)==="satellite"?"active":""}`,"svelte-wdx2yi")}),P("click",St,R),P("click",ft,()=>G("street")),P("click",Tt,()=>G("satellite")),C(e,I),ht(t,"invalidateSize",O),ht(t,"showRoute",B);var Ft=Y({invalidateSize:O,showRoute:B});return c(),Ft}var Me=z('<div class="route-card svelte-u69c1r" role="button" tabindex="0" aria-label="View route details"><div class="mini-map svelte-u69c1r"></div> <div class="route-info svelte-u69c1r"><div class="route-header-info svelte-u69c1r"><div><div class="route-date svelte-u69c1r"> </div> <div class="route-time svelte-u69c1r"> </div></div></div> <div class="route-stats-grid svelte-u69c1r"><div class="route-stat svelte-u69c1r"><div class="route-stat-value svelte-u69c1r"> </div> <div class="route-stat-label svelte-u69c1r">Distance</div></div> <div class="route-stat svelte-u69c1r"><div class="route-stat-value svelte-u69c1r"> </div> <div class="route-stat-label svelte-u69c1r">Duration</div></div> <div class="route-stat svelte-u69c1r"><div class="route-stat-value svelte-u69c1r"> </div> <div class="route-stat-label svelte-u69c1r">Avg Speed</div></div></div> <div class="route-actions svelte-u69c1r"><button class="route-action export-btn svelte-u69c1r">Export</button> <button class="route-action delete-btn svelte-u69c1r">Delete</button></div></div></div>');function je(e,t){J(t,!1);let a=j(t,"route",8),c=j(t,"onView",8,()=>{}),u=j(t,"onExport",8,()=>{}),n=j(t,"onDelete",8,()=>{}),i,d=V();ut(async()=>{const R=await yt(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url);if(y(d)){i=R.map(y(d),{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1}),R.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(i);const I=R.polyline(a().positions,{color:"#3B82F6",weight:3,opacity:.8}).addTo(i);i.fitBounds(I.getBounds(),{padding:[20,20]})}return()=>{i&&i.remove()}});function k(R){(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),c()())}X();var _=Me(),s=m(_);rt(s,R=>M(d,R),()=>y(d));var v=S(s,2),r=m(v),l=m(r),f=m(l),x=m(f,!0);g(f);var h=S(f,2),p=m(h);g(h),g(l),g(r);var o=S(r,2),w=m(o),b=m(w),D=m(b,!0);g(b),it(2),g(w);var T=S(w,2),L=m(T),$=m(L,!0);g(L),it(2),g(T);var O=S(T,2),B=m(O),G=m(B);g(B),it(2),g(O),g(o);var K=S(o,2),W=m(K),nt=S(W,2);g(K),g(v),g(_),vt((R,I,Q,tt)=>{A(x,R),A(p,`${a().startTime??""} - ${a().endTime??""}`),A(D,I),A($,Q),A(G,`${tt??""} km/h`)},[()=>new Date(a().date).toLocaleDateString(),()=>wt(a().distance),()=>kt(a().duration),()=>a().avgSpeed.toFixed(1)],ct),P("click",W,jt(function(...R){var I;(I=u())==null||I.apply(this,R)})),P("click",nt,jt(function(...R){var I;(I=n())==null||I.apply(this,R)})),P("click",_,function(...R){var I;(I=c())==null||I.apply(this,R)}),P("keydown",_,k),C(e,_),Y()}const xt="mapme_routes";function Ce(e){if(typeof window>"u")return;const t=q();t.unshift(e),localStorage.setItem(xt,JSON.stringify(t))}function q(){if(typeof window>"u")return[];const e=localStorage.getItem(xt);return e?JSON.parse(e):[]}function $e(e){if(typeof window>"u")return;const a=q().filter(c=>c.id!==e);localStorage.setItem(xt,JSON.stringify(a))}var Ae=z('<div class="empty-state svelte-ckk6gu"><p>No routes recorded yet.</p> <p>Tap the map tab to start tracking!</p></div>'),Pe=z('<div class="history-container svelte-ckk6gu"><div class="history-header svelte-ckk6gu"><h1 class="history-title svelte-ckk6gu">Your Routes</h1></div> <div class="route-list svelte-ckk6gu"><!></div></div>');function ze(e,t){J(t,!1);const[a,c]=ot(),u=()=>lt(N,"$appState",a);let n=j(t,"onViewRoute",8,()=>{}),i=j(t,"onExportRoute",8,()=>{}),d=V([]);ut(()=>{M(d,q())});function k(h){confirm("Delete this route?")&&($e(h),M(d,q()))}function _(){console.log("Refreshing routes list..."),M(d,q()),console.log("Current routes:",y(d))}Ot(()=>(u(),q),()=>{u()==="history"&&M(d,q())}),Vt(),X();var s=Pe(),v=S(m(s),2),r=m(v);{var l=h=>{var p=Ae();C(h,p)},f=h=>{var p=$t(),o=bt(p);pe(o,1,()=>y(d),w=>w.id,(w,b)=>{je(w,{get route(){return y(b)},onView:()=>n()(y(b)),onExport:()=>i()(y(b)),onDelete:()=>k(y(b).id)})}),C(h,p)};U(r,h=>{y(d).length===0?h(l):h(f,!1)})}g(v),g(s),C(e,s),ht(t,"refresh",_);var x=Y({refresh:_});return c(),x}var Oe=z('<div class="route-detail-container svelte-17g9eae"><div class="route-header svelte-17g9eae"><button class="back-button svelte-17g9eae">‚Üê Back to Routes</button> <div class="route-info svelte-17g9eae"><h1 class="route-title svelte-17g9eae"> </h1> <p class="route-date svelte-17g9eae"> </p> <p class="route-time svelte-17g9eae"> </p></div> <div class="route-stats svelte-17g9eae"><div class="stat svelte-17g9eae"><span class="stat-value svelte-17g9eae"> </span> <span class="stat-label svelte-17g9eae">Distance</span></div> <div class="stat svelte-17g9eae"><span class="stat-value svelte-17g9eae"> </span> <span class="stat-label svelte-17g9eae">Duration</span></div> <div class="stat svelte-17g9eae"><span class="stat-value svelte-17g9eae"> </span> <span class="stat-label svelte-17g9eae">Avg Speed</span></div></div></div> <div class="map-container svelte-17g9eae"><div id="route-detail-map" class="svelte-17g9eae"></div></div></div>');function Ve(e,t){J(t,!1);const[a,c]=ot();let u=j(t,"route",8),n,i,d=V();ut(async()=>{i=await yt(()=>import("../chunks/r9KgTLRM.js").then(I=>I.l),[],import.meta.url),delete i.Icon.Default.prototype._getIconUrl,i.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),n=i.map(y(d),{zoomControl:!0,dragging:!0,touchZoom:!0,scrollWheelZoom:!0,doubleClickZoom:!0}),i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors",maxZoom:19}).addTo(n);const R=i.polyline(u().positions,{color:"#10B981",weight:5,opacity:.8}).addTo(n);return i.marker(u().positions[0]).addTo(n).bindPopup("Start: "+u().startTime).openPopup(),i.marker(u().positions[u().positions.length-1]).addTo(n).bindPopup("End: "+u().endTime),n.fitBounds(R.getBounds(),{padding:[50,50]}),()=>{n&&n.remove()}});function k(){H(N,"history")}X();var _=Oe(),s=m(_),v=m(s),r=S(v,2),l=m(r),f=m(l,!0);g(l);var x=S(l,2),h=m(x,!0);g(x);var p=S(x,2),o=m(p);g(p),g(r);var w=S(r,2),b=m(w),D=m(b),T=m(D,!0);g(D),it(2),g(b);var L=S(b,2),$=m(L),O=m($,!0);g($),it(2),g(L);var B=S(L,2),G=m(B),K=m(G);g(G),it(2),g(B),g(w),g(s);var W=S(s,2),nt=m(W);rt(nt,R=>M(d,R),()=>y(d)),g(W),g(_),vt((R,I,Q,tt)=>{A(f,u().name),A(h,R),A(o,`${u().startTime??""} - ${u().endTime??""}`),A(T,I),A(O,Q),A(K,`${tt??""} km/h`)},[()=>new Date(u().date).toLocaleDateString(),()=>wt(u().distance),()=>kt(u().duration),()=>u().avgSpeed.toFixed(1)],ct),P("click",v,k),C(e,_),Y(),c()}var Be=z('<div class="floating-nav svelte-1lwjzpb"><button class="nav-button svelte-1lwjzpb">Routes</button></div>'),Ne=z('<div class="floating-nav svelte-1lwjzpb"><button class="nav-button svelte-1lwjzpb">Map</button></div>');function Ue(e,t){J(t,!1);const[a,c]=ot(),u=()=>lt(N,"$appState",a);let n=j(t,"onHistoryClick",8,()=>{});X();var i=$t(),d=bt(i);{var k=s=>{var v=Be(),r=m(v);g(v),P("click",r,()=>{H(N,"history"),n()()}),C(s,v)},_=(s,v)=>{{var r=l=>{var f=Ne(),x=m(f);g(f),P("click",x,()=>H(N,"idle")),C(l,f)};U(s,l=>{u()==="history"&&l(r)},v)}};U(d,s=>{u()==="idle"?s(k):s(_,!1)})}C(e,i),Y(),c()}var Ze=z('<div class="app-container svelte-3timjr"><div class="view-container svelte-3timjr"><!></div> <!></div>');function Xe(e,t){J(t,!1);const[a,c]=ot(),u=()=>lt(N,"$appState",a),n=()=>lt(Ct,"$selectedRoute",a);let i=V(),d=V();function k(o){const w=o.detail;console.log("Route complete:",w);const b={id:ye(),name:`Route ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`,...w,date:be()};console.log("Saving route:",b),Ce(b),H(N,"history")}function _(o){H(Ct,o),H(N,"viewing-route")}function s(o){const w=v(o),b=new Blob([w],{type:"application/gpx+xml"}),D=URL.createObjectURL(b),T=document.createElement("a");T.href=D,T.download=`route_${o.date.split("T")[0]}.gpx`,T.click(),URL.revokeObjectURL(D)}function v(o){const w=o.positions.map((b,D)=>{var L;const T=(L=o.timestamps)!=null&&L[D]?new Date(o.timestamps[D]).toISOString():new Date(o.date).toISOString();return`<trkpt lat="${b[0]}" lon="${b[1]}">
				<time>${T}</time>
			</trkpt>`}).join(`
			`);return`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapMe">
	<metadata>
		<name>${o.name}</name>
		<time>${o.date}</time>
	</metadata>
	<trk>
		<name>${o.name}</name>
		<trkseg>
			${w}
		</trkseg>
	</trk>
</gpx>`}Ot(()=>(u(),y(i)),()=>{u()==="idle"&&y(i)&&y(i).invalidateSize()}),Vt(),X();var r=Ze(),l=m(r),f=m(l);{var x=o=>{rt(Ie(o,{$$events:{routeComplete:k},$$legacy:!0}),w=>M(i,w),()=>y(i))},h=(o,w)=>{{var b=T=>{rt(ze(T,{onViewRoute:_,onExportRoute:s,$$legacy:!0}),L=>M(d,L),()=>y(d))},D=(T,L)=>{{var $=O=>{Ve(O,{get route(){return n()}})};U(T,O=>{u()==="viewing-route"&&n()&&O($)},L)}};U(o,T=>{u()==="history"?T(b):T(D,!1)},w)}};U(f,o=>{u()==="idle"||u()==="tracking"?o(x):o(h,!1)})}g(l);var p=S(l,2);Ue(p,{}),g(r),C(e,r),Y(),c()}export{Xe as component};
