import{f as N,a as C,c as zt}from"../chunks/CT4Q5n2T.js";import"../chunks/C1QAvf4w.js";import{m as j,n as Wt,X as qt,g as b,ab as dt,Z as Jt,_ as Yt,$ as Et,G as Rt,F as mt,I as nt,J as Xt,a0 as Pt,Q as Nt,a1 as Kt,N as Ot,y as Qt,a6 as V,ao as Mt,ap as ht,w as Lt,aq as te,ar as ee,as as ae,M as oe,at as re,au as ne,av as ie,aw as se,D as le,ax as de,ay as ce,az as ue,a8 as ve,z as fe,p as J,k as g,s as k,l as m,t as ct,j as Y,i as _t,a7 as I,aA as ot,aB as Vt,aC as Bt}from"../chunks/CHNfuCAn.js";import{p as A,i as H,_ as yt,b as it,s as st,a as F,c as lt}from"../chunks/CSUyK52U.js";import{i as X}from"../chunks/6ror7A3X.js";import{w as Ut,c as pe,o as ut,a as ge}from"../chunks/BKrcMcEU.js";import{s as z,e as P}from"../chunks/iBxjlEiN.js";function me(e,t,a,d){for(var s=[],r=t.length,o=0;o<r;o++)ae(t[o].e,s,!0);var v=r>0&&s.length===0&&a!==null;if(v){var y=a.parentNode;oe(y),y.append(a),d.clear(),Z(e,t[0].prev,t[r-1].next)}re(s,()=>{for(var h=0;h<r;h++){var n=t[h];v||(d.delete(n.k),Z(e,n.prev,n.next)),ne(n.e,!v)}})}function he(e,t,a,d,s,r=null){var o=e,v={flags:t,items:new Map,first:null};j&&Wt();var y=null,h=!1,n=dt(()=>{var u=a();return Qt(u)?u:u==null?[]:Ot(u)});qt(()=>{var u=b(n),i=u.length;if(h&&i===0)return;h=i===0;let c=!1;if(j){var p=Jt(o)===Yt;p!==(i===0)&&(o=Et(),Rt(o),mt(!1),c=!0)}if(j){for(var S=null,x,f=0;f<i;f++){if(nt.nodeType===8&&nt.data===Xt){o=nt,c=!0,mt(!1);break}var l=u[f],w=d(l,f);x=jt(nt,v,S,null,l,w,f,s,t,a),v.items.set(w,x),S=x}i>0&&Rt(Et())}j||xe(u,v,o,s,t,d,a),r!==null&&(i===0?y?Pt(y):y=Nt(()=>r(o)):y!==null&&Kt(y,()=>{y=null})),c&&mt(!0),b(n)}),j&&(o=nt)}function xe(e,t,a,d,s,r,o){var v=e.length,y=t.items,h=t.first,n=h,u,i=null,c=[],p=[],S,x,f,l;for(l=0;l<v;l+=1){if(S=e[l],x=r(S,l),f=y.get(x),f===void 0){var w=n?n.e.nodes_start:a;i=jt(w,t,i,i===null?t.first:i.next,S,x,l,d,s,o),y.set(x,i),c=[],p=[],n=i.next;continue}if(be(f,S,l),(f.e.f&ht)!==0&&Pt(f.e),f!==n){if(u!==void 0&&u.has(f)){if(c.length<p.length){var _=p[0],D;i=_.prev;var T=c[0],M=c[c.length-1];for(D=0;D<c.length;D+=1)It(c[D],_,a);for(D=0;D<p.length;D+=1)u.delete(p[D]);Z(t,T.prev,M.next),Z(t,i,T),Z(t,M,_),n=_,i=M,l-=1,c=[],p=[]}else u.delete(f),It(f,n,a),Z(t,f.prev,f.next),Z(t,f,i===null?t.first:i.next),Z(t,i,f),i=f;continue}for(c=[],p=[];n!==null&&n.k!==x;)(n.e.f&ht)===0&&(u??(u=new Set)).add(n),p.push(n),n=n.next;if(n===null)continue;f=n}c.push(f),i=f,n=f.next}if(n!==null||u!==void 0){for(var $=u===void 0?[]:Ot(u);n!==null;)(n.e.f&ht)===0&&$.push(n),n=n.next;var O=$.length;if(O>0){var B=null;me(t,$,B,y)}}Lt.first=t.first&&t.first.e,Lt.last=i&&i.e}function be(e,t,a,d){ee(e.v,t),e.i=a}function jt(e,t,a,d,s,r,o,v,y,h){var n=(y&ie)!==0,u=(y&se)===0,i=n?u?V(s):Mt(s):s,c=(y&te)===0?o:Mt(o),p={i:c,v:i,k:r,a:null,e:null,prev:a,next:d};try{return p.e=Nt(()=>v(e,i,c,h),j),p.e.prev=a&&a.e,p.e.next=d&&d.e,a===null?t.first=p:(a.next=p,a.e.next=p.e),d!==null&&(d.prev=p,d.e.prev=p.e),p}finally{}}function It(e,t,a){for(var d=e.next?e.next.e.nodes_start:a,s=t?t.e.nodes_start:a,r=e.e.nodes_start;r!==d;){var o=le(r);s.before(r),r=o}}function Z(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function _e(e,t,a){var d=e==null?"":""+e;return d===""?null:d}function xt(e,t,a,d,s,r){var o=e.__className;if(j||o!==a||o===void 0){var v=_e(a);(!j||v!==e.getAttribute("class"))&&(v==null?e.removeAttribute("class"):e.className=v),e.__className=a}return r}const ye=Symbol("is custom element"),we=Symbol("is html");function Se(e,t,a,d){var s=ke(e);j&&(s[t]=e.getAttribute(t)),s[t]!==(s[t]=a)&&(a==null?e.removeAttribute(t):typeof a!="string"&&Te(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function ke(e){return e.__attributes??(e.__attributes={[ye]:e.nodeName.includes("-"),[we]:e.namespaceURI===de})}var At=new Map;function Te(e){var t=At.get(e.nodeName);if(t)return t;At.set(e.nodeName,t=[]);for(var a,d=e,s=Element.prototype;s!==d;){a=ue(d);for(var r in a)a[r].set&&t.push(r);d=ce(d)}return t}function bt(e,t,a){var d=ve(e,t);d&&d.set&&(e[t]=a,fe(()=>{e[t]=null}))}function Ct(e){return function(...t){var a=t[0];return a.stopPropagation(),e==null?void 0:e.apply(this,t)}}function De(e){let t=0;for(let a=1;a<e.length;a++){const[d,s]=e[a-1],[r,o]=e[a],v=6371,y=(r-d)*Math.PI/180,h=(o-s)*Math.PI/180,n=Math.sin(y/2)*Math.sin(y/2)+Math.cos(d*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2),u=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),i=v*u;t+=i}return t}function Ee(e,t){return t===0?0:e/t*3600}function wt(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),d=Math.floor(e%60);return t>0?`${t}h ${a}m ${d}s`:a>0?`${a}m ${d}s`:`${d}s`}function St(e){return e<1?`${Math.round(e*1e3)}m`:`${e.toFixed(2)}km`}function Re(){return new Date().toISOString()}function Me(){return`route_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}var Le=N('<div class="absolute top-2.5 left-2.5 bg-white/95 p-4 rounded-xl shadow-md z-[400] min-w-[200px] sm:top-[60px] sm:left-2.5 sm:right-2.5 sm:min-w-0"><div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Time:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Distance:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Current Speed:</span> <span class="font-bold text-gray-800"> </span></div> <div class="flex justify-between my-1.5 text-sm"><span class="font-semibold text-gray-500">Avg Speed:</span> <span class="font-bold text-gray-800"> </span></div></div>');function Ie(e,t){J(t,!1);let a=A(t,"elapsedTime",8,0),d=A(t,"distance",8,0),s=A(t,"currentSpeed",8,0),r=A(t,"avgSpeed",8,0);X();var o=Le(),v=g(o),y=k(g(v),2),h=g(y,!0);m(y),m(v);var n=k(v,2),u=k(g(n),2),i=g(u,!0);m(u),m(n);var c=k(n,2),p=k(g(c),2),S=g(p);m(p),m(c);var x=k(c,2),f=k(g(x),2),l=g(f);m(f),m(x),m(o),ct((w,_,D,T)=>{z(h,w),z(i,_),z(S,`${D??""} km/h`),z(l,`${T??""} km/h`)},[()=>wt(a()),()=>St(d()),()=>s().toFixed(1),()=>r().toFixed(1)],dt),C(e,o),Y()}var Ae=N('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-green-500 hover:bg-green-600">Start Tracking</button>'),Ce=N('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-amber-500 hover:bg-amber-600">Pause</button>'),$e=N('<button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-blue-500 hover:bg-blue-600">Resume</button>'),ze=N('<!> <button class="px-7 py-3.5 border-none rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white flex items-center gap-2 bg-red-500 hover:bg-red-600">Stop</button>',1),Pe=N('<div class="absolute bottom-5 left-5 flex gap-2.5 z-[400]"><!></div>');function Ne(e,t){let a=A(t,"tracking",8,!1),d=A(t,"paused",8,!1),s=A(t,"onStart",8,()=>{}),r=A(t,"onPause",8,()=>{}),o=A(t,"onStop",8,()=>{});var v=Pe(),y=g(v);{var h=u=>{var i=Ae();P("click",i,function(...c){var p;(p=s())==null||p.apply(this,c)}),C(u,i)},n=u=>{var i=ze(),c=_t(i);{var p=f=>{var l=Ce();P("click",l,function(...w){var _;(_=r())==null||_.apply(this,w)}),C(f,l)},S=f=>{var l=$e();P("click",l,function(...w){var _;(_=r())==null||_.apply(this,w)}),C(f,l)};H(c,f=>{d()?f(S,!1):f(p)})}var x=k(c,2);P("click",x,function(...f){var l;(l=o())==null||l.apply(this,f)}),C(u,i)};H(y,u=>{a()?u(n,!1):u(h)})}m(v),C(e,v)}const U=Ut("idle"),$t=Ut(null);var Oe=N('<div class="w-full h-full relative"><div id="map" class="w-full h-full"></div> <!> <div class="absolute top-2.5 right-[60px] flex flex-col gap-2.5 z-[400]"><button><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path></svg></button></div> <div class="absolute bottom-20 right-2.5 flex gap-1.5 z-[400] bg-white/90 p-1.5 rounded-lg"><button>Street</button> <button>Satellite</button></div> <!></div>');function Ve(e,t){J(t,!1);const[a,d]=st(),s=pe();let r,o,v,y=V(),h=V("street"),n=V(!0),u=A(t,"tracking",12,!1),i=A(t,"paused",12,!1),c=[],p=[],S=null,x=null,f=null,l=null,w=V(0),_=V(0),D=V(0),T=V(0),M=null;const $={street:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"},satellite:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"}};ut(async()=>{o=await yt(()=>import("../chunks/r9KgTLRM.js").then(R=>R.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(b(y),{zoomControl:!1}).setView([40.7128,-74.006],13),o.control.zoom({position:"topright"}).addTo(r),v=o.tileLayer($[b(h)].url,{attribution:$[b(h)].attribution,maxZoom:19}).addTo(r),navigator.geolocation&&navigator.geolocation.getCurrentPosition(R=>{const{latitude:et,longitude:at}=R.coords;r.setView([et,at],16),f=o.marker([et,at]).addTo(r).bindPopup("Current location")},R=>{console.error("Error getting location:",R)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),ge(()=>{S!==null&&navigator.geolocation.clearWatch(S),M!==null&&clearInterval(M),r&&r.remove()});function O(){r&&setTimeout(()=>{r.invalidateSize()},100)}function B(R){!r||!o||(x&&r.removeLayer(x),x=o.polyline(R.positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r),o.marker(R.positions[0]).addTo(r).bindPopup("Start").openPopup(),o.marker(R.positions[R.positions.length-1]).addTo(r).bindPopup("End"),r.fitBounds(x.getBounds(),{padding:[50,50]}))}function G(R){!o||!r||(I(h,R),v&&(r.removeLayer(v),v=o.tileLayer($[b(h)].url,{attribution:$[b(h)].attribution,maxZoom:19}).addTo(r)))}function K(){if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}F(U,"tracking"),u(!0),i(!1),c=[],p=[],l=Date.now(),M=setInterval(()=>{i()||I(w,Math.floor((Date.now()-l)/1e3))},1e3),S=navigator.geolocation.watchPosition(R=>{if(i())return;const{latitude:et,longitude:at,speed:Dt,accuracy:Gt}=R.coords;Gt>50||(c=[...c,[et,at]],p=[...p,Date.now()],f&&f.setLatLng([et,at]),c.length>1&&(I(_,De(c)),I(T,Ee(b(_),b(w))),I(D,Dt?Dt*3.6:0)),c.length>1&&(x?x.setLatLngs(c):x=o.polyline(c,{color:"#3B82F6",weight:5,opacity:.8,smoothFactor:1}).addTo(r)),b(n)&&r.setView([et,at],r.getZoom(),{animate:!0,duration:.5}))},R=>{console.error("Error tracking position:",R)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})}function W(){i(!i()),i()&&(l+=Date.now()-(l+b(w)*1e3))}function rt(){if(F(U,"idle"),u(!1),i(!1),S!==null&&(navigator.geolocation.clearWatch(S),S=null),M!==null&&(clearInterval(M),M=null),c.length>1){const R={positions:c,timestamps:p,distance:b(_),duration:b(w),avgSpeed:b(T),startTime:new Date(p[0]).toLocaleTimeString(),endTime:new Date(p[p.length-1]).toLocaleTimeString()};console.log("Dispatching route complete event:",R),s("routeComplete",R),x&&(r.removeLayer(x),x=null),c=[],p=[],I(_,0),I(w,0),I(D,0),I(T,0)}}function E(){I(n,!b(n))}X();var L=Oe(),Q=g(L);it(Q,R=>I(y,R),()=>b(y));var tt=k(Q,2);{var Ht=R=>{Ie(R,{get elapsedTime(){return b(w)},get distance(){return b(_)},get currentSpeed(){return b(D)},get avgSpeed(){return b(T)}})};H(tt,R=>{u()&&R(Ht)})}var vt=k(tt,2),ft=g(vt);m(vt);var pt=k(vt,2),gt=g(pt),Tt=k(gt,2);m(pt);var Zt=k(pt,2);Ne(Zt,{get tracking(){return u()},get paused(){return i()},onStart:K,onPause:W,onStop:rt}),m(L),ct(()=>{xt(ft,1,`border-none w-10 h-10 rounded-lg cursor-pointer shadow-md flex items-center justify-center transition-all duration-200 hover:scale-105 ${b(n)?"bg-blue-500 text-white hover:bg-blue-600":"bg-white text-gray-700 hover:bg-gray-100"}`),Se(ft,"title",`${b(n)?"Disable":"Enable"} location following`),xt(gt,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${b(h)==="street"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`),xt(Tt,1,`px-3 py-2 border-none rounded-md cursor-pointer text-xs transition-all duration-200 ${b(h)==="satellite"?"bg-blue-500 text-white hover:bg-blue-600":"bg-white hover:bg-gray-100"}`)}),P("click",ft,E),P("click",gt,()=>G("street")),P("click",Tt,()=>G("satellite")),C(e,L),bt(t,"invalidateSize",O),bt(t,"showRoute",B);var Ft=Y({invalidateSize:O,showRoute:B});return d(),Ft}var Be=N('<div class="bg-white rounded-2xl overflow-hidden shadow-md cursor-pointer transition-all duration-200 outline-none hover:-translate-y-0.5 hover:shadow-lg focus:outline-2 focus:outline-offset-2 focus:outline-blue-500" role="button" tabindex="0" aria-label="View route details"><div class="w-full h-[150px] bg-gray-200"></div> <div class="p-4"><div class="flex justify-between items-start mb-2.5"><div><div class="text-base font-semibold text-gray-800"> </div> <div class="text-sm text-gray-500"> </div></div></div> <div class="grid grid-cols-3 gap-2.5 mb-2.5"><div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Distance</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Duration</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-800"> </div> <div class="text-xs text-gray-500">Avg Speed</div></div></div> <div class="flex gap-2.5 mt-2.5"><button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-blue-100 text-blue-700 hover:bg-blue-200">Export</button> <button class="flex-1 p-2 border-none rounded-lg text-sm cursor-pointer transition-all duration-200 bg-red-100 text-red-700 hover:bg-red-200">Delete</button></div></div></div>');function Ue(e,t){J(t,!1);let a=A(t,"route",8),d=A(t,"onView",8,()=>{}),s=A(t,"onExport",8,()=>{}),r=A(t,"onDelete",8,()=>{}),o,v=V();ut(async()=>{const E=await yt(()=>import("../chunks/r9KgTLRM.js").then(L=>L.l),[],import.meta.url);if(b(v)){o=E.map(b(v),{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1}),E.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(o);const L=E.polyline(a().positions,{color:"#3B82F6",weight:3,opacity:.8}).addTo(o);o.fitBounds(L.getBounds(),{padding:[20,20]})}return()=>{o&&o.remove()}});function y(E){(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),d()())}X();var h=Be(),n=g(h);it(n,E=>I(v,E),()=>b(v));var u=k(n,2),i=g(u),c=g(i),p=g(c),S=g(p,!0);m(p);var x=k(p,2),f=g(x);m(x),m(c),m(i);var l=k(i,2),w=g(l),_=g(w),D=g(_,!0);m(_),ot(2),m(w);var T=k(w,2),M=g(T),$=g(M,!0);m(M),ot(2),m(T);var O=k(T,2),B=g(O),G=g(B);m(B),ot(2),m(O),m(l);var K=k(l,2),W=g(K),rt=k(W,2);m(K),m(u),m(h),ct((E,L,Q,tt)=>{z(S,E),z(f,`${a().startTime??""} - ${a().endTime??""}`),z(D,L),z($,Q),z(G,`${tt??""} km/h`)},[()=>new Date(a().date).toLocaleDateString(),()=>St(a().distance),()=>wt(a().duration),()=>a().avgSpeed.toFixed(1)],dt),P("click",W,Ct(function(...E){var L;(L=s())==null||L.apply(this,E)})),P("click",rt,Ct(function(...E){var L;(L=r())==null||L.apply(this,E)})),P("click",h,function(...E){var L;(L=d())==null||L.apply(this,E)}),P("keydown",h,y),C(e,h),Y()}const kt="mapme_routes";function je(e){if(typeof window>"u")return;const t=q();t.unshift(e),localStorage.setItem(kt,JSON.stringify(t))}function q(){if(typeof window>"u")return[];const e=localStorage.getItem(kt);return e?JSON.parse(e):[]}function He(e){if(typeof window>"u")return;const a=q().filter(d=>d.id!==e);localStorage.setItem(kt,JSON.stringify(a))}var Ze=N('<div class="text-center py-16 px-5 text-gray-500"><p>No routes recorded yet.</p> <p>Tap the map tab to start tracking!</p></div>'),Fe=N('<div class="h-full overflow-y-auto bg-gray-100 relative"><div class="bg-white p-5 shadow-lg sticky top-0 z-[500]"><h1 class="text-2xl font-bold m-0">Your Routes</h1></div> <div class="p-4 flex flex-col gap-4 pb-24"><!></div></div>');function Ge(e,t){J(t,!1);const[a,d]=st(),s=()=>lt(U,"$appState",a);let r=A(t,"onViewRoute",8,()=>{}),o=A(t,"onExportRoute",8,()=>{}),v=V([]);ut(()=>{I(v,q())});function y(x){confirm("Delete this route?")&&(He(x),I(v,q()))}function h(){console.log("Refreshing routes list..."),I(v,q()),console.log("Current routes:",b(v))}Vt(()=>(s(),q),()=>{s()==="history"&&I(v,q())}),Bt(),X();var n=Fe(),u=k(g(n),2),i=g(u);{var c=x=>{var f=Ze();C(x,f)},p=x=>{var f=zt(),l=_t(f);he(l,1,()=>b(v),w=>w.id,(w,_)=>{Ue(w,{get route(){return b(_)},onView:()=>r()(b(_)),onExport:()=>o()(b(_)),onDelete:()=>y(b(_).id)})}),C(x,f)};H(i,x=>{b(v).length===0?x(c):x(p,!1)})}m(u),m(n),C(e,n),bt(t,"refresh",h);var S=Y({refresh:h});return d(),S}var We=N('<div class="h-screen flex flex-col"><div class="bg-white p-5 shadow-md z-[100] sm:p-4"><button class="bg-transparent border-none text-blue-500 text-base cursor-pointer mb-4 p-1 hover:underline">← Back to Routes</button> <div class="mb-5"><h1 class="text-2xl font-bold m-0 mb-1 text-gray-800"> </h1> <p class="text-base text-gray-500 m-0"> </p> <p class="text-sm text-gray-400 mt-1 mb-0"> </p></div> <div class="flex gap-8 sm:gap-5"><div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Distance</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Duration</span></div> <div class="flex flex-col items-center"><span class="text-xl font-bold text-gray-800 sm:text-lg"> </span> <span class="text-xs text-gray-500 mt-1">Avg Speed</span></div></div></div> <div class="flex-1 relative"><div class="w-full h-full"></div></div></div>');function qe(e,t){J(t,!1);const[a,d]=st();let s=A(t,"route",8),r,o,v=V();ut(async()=>{o=await yt(()=>import("../chunks/r9KgTLRM.js").then(L=>L.l),[],import.meta.url),delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"}),r=o.map(b(v),{zoomControl:!0,dragging:!0,touchZoom:!0,scrollWheelZoom:!0,doubleClickZoom:!0}),o.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(r);const E=o.polyline(s().positions,{color:"#10B981",weight:5,opacity:.8}).addTo(r);return o.marker(s().positions[0]).addTo(r).bindPopup("Start: "+s().startTime).openPopup(),o.marker(s().positions[s().positions.length-1]).addTo(r).bindPopup("End: "+s().endTime),r.fitBounds(E.getBounds(),{padding:[50,50]}),()=>{r&&r.remove()}});function y(){F(U,"history")}X();var h=We(),n=g(h),u=g(n),i=k(u,2),c=g(i),p=g(c,!0);m(c);var S=k(c,2),x=g(S,!0);m(S);var f=k(S,2),l=g(f);m(f),m(i);var w=k(i,2),_=g(w),D=g(_),T=g(D,!0);m(D),ot(2),m(_);var M=k(_,2),$=g(M),O=g($,!0);m($),ot(2),m(M);var B=k(M,2),G=g(B),K=g(G);m(G),ot(2),m(B),m(w),m(n);var W=k(n,2),rt=g(W);it(rt,E=>I(v,E),()=>b(v)),m(W),m(h),ct((E,L,Q,tt)=>{z(p,s().name),z(x,E),z(l,`${s().startTime??""} - ${s().endTime??""}`),z(T,L),z(O,Q),z(K,`${tt??""} km/h`)},[()=>new Date(s().date).toLocaleDateString(),()=>St(s().distance),()=>wt(s().duration),()=>s().avgSpeed.toFixed(1)],dt),P("click",u,y),C(e,h),Y(),d()}var Je=N('<div class="fixed bottom-5 right-5 flex gap-2.5 z-[400] pb-safe"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Routes</button></div>'),Ye=N('<div class="fixed bottom-5 right-5 flex gap-2.5 z-[400] pb-safe"><button class="px-7 py-3.5 rounded-full text-base font-semibold cursor-pointer transition-all duration-300 shadow-lg text-white bg-gray-500 hover:bg-gray-600 hover:scale-105 hover:shadow-xl">Map</button></div>');function Xe(e,t){J(t,!1);const[a,d]=st(),s=()=>lt(U,"$appState",a);let r=A(t,"onHistoryClick",8,()=>{});X();var o=zt(),v=_t(o);{var y=n=>{var u=Je(),i=g(u);m(u),P("click",i,()=>{F(U,"history"),r()()}),C(n,u)},h=(n,u)=>{{var i=c=>{var p=Ye(),S=g(p);m(p),P("click",S,()=>F(U,"idle")),C(c,p)};H(n,c=>{s()==="history"&&c(i)},u)}};H(v,n=>{s()==="idle"?n(y):n(h,!1)})}C(e,o),Y(),d()}var Ke=N('<div class="w-screen h-screen overflow-hidden relative flex flex-col"><div class="flex-1 relative overflow-hidden"><!></div> <!></div>');function ia(e,t){J(t,!1);const[a,d]=st(),s=()=>lt(U,"$appState",a),r=()=>lt($t,"$selectedRoute",a);let o=V(),v=V();function y(l){const w=l.detail;console.log("Route complete:",w);const _={id:Me(),name:`Route ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`,...w,date:Re()};console.log("Saving route:",_),je(_),F(U,"history")}function h(l){F($t,l),F(U,"viewing-route")}function n(l){const w=u(l),_=new Blob([w],{type:"application/gpx+xml"}),D=URL.createObjectURL(_),T=document.createElement("a");T.href=D,T.download=`route_${l.date.split("T")[0]}.gpx`,T.click(),URL.revokeObjectURL(D)}function u(l){const w=l.positions.map((_,D)=>{var M;const T=(M=l.timestamps)!=null&&M[D]?new Date(l.timestamps[D]).toISOString():new Date(l.date).toISOString();return`<trkpt lat="${_[0]}" lon="${_[1]}">
				<time>${T}</time>
			</trkpt>`}).join(`
			`);return`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapMe">
	<metadata>
		<name>${l.name}</name>
		<time>${l.date}</time>
	</metadata>
	<trk>
		<name>${l.name}</name>
		<trkseg>
			${w}
		</trkseg>
	</trk>
</gpx>`}Vt(()=>(s(),b(o)),()=>{s()==="idle"&&b(o)&&b(o).invalidateSize()}),Bt(),X();var i=Ke(),c=g(i),p=g(c);{var S=l=>{it(Ve(l,{$$events:{routeComplete:y},$$legacy:!0}),w=>I(o,w),()=>b(o))},x=(l,w)=>{{var _=T=>{it(Ge(T,{onViewRoute:h,onExportRoute:n,$$legacy:!0}),M=>I(v,M),()=>b(v))},D=(T,M)=>{{var $=O=>{qe(O,{get route(){return r()}})};H(T,O=>{s()==="viewing-route"&&r()&&O($)},M)}};H(l,T=>{s()==="history"?T(_):T(D,!1)},w)}};H(p,l=>{s()==="idle"||s()==="tracking"?l(S):l(x,!1)})}m(c);var f=k(c,2);Xe(f,{}),m(i),C(e,i),Y(),d()}export{ia as component};
